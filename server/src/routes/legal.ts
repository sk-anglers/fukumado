import { Router, Request, Response } from 'express';

export const legalRouter = Router();

/**
 * 利用規約の内容
 */
const TERMS_OF_SERVICE = {
  version: '1.0.0',
  effectiveDate: '2025-01-01',
  lastUpdated: '2025-01-01',
  content: `
# 利用規約

最終更新日: 2025年1月1日
バージョン: 1.0.0

## 第1条（適用）

1. 本利用規約（以下「本規約」といいます）は、当サービス（以下「本サービス」といいます）の利用条件を定めるものです。
2. 登録ユーザーの皆さま（以下「ユーザー」といいます）には、本規約に従って本サービスをご利用いただきます。

## 第2条（利用登録）

1. 本サービスにおいては、登録希望者が本規約に同意の上、当社の定める方法によって利用登録を申請し、当社がこれを承認することによって、利用登録が完了するものとします。
2. 当社は、利用登録の申請者に以下の事由があると判断した場合、利用登録の申請を承認しないことがあります。

## 第3条（ユーザーIDおよびパスワードの管理）

1. ユーザーは、自己の責任において、本サービスのユーザーIDおよびパスワードを適切に管理するものとします。
2. ユーザーは、いかなる場合にも、ユーザーIDおよびパスワードを第三者に譲渡または貸与し、もしくは第三者と共用することはできません。

## 第4条（禁止事項）

ユーザーは、本サービスの利用にあたり、以下の行為をしてはなりません。

1. 法令または公序良俗に違反する行為
2. 犯罪行為に関連する行為
3. 本サービスの内容等、本サービスに含まれる著作権、商標権ほか知的財産権を侵害する行為
4. 当社、ほかのユーザー、またはその他第三者のサーバーまたはネットワークの機能を破壊したり、妨害したりする行為
5. 本サービスによって得られた情報を商業的に利用する行為
6. 当社のサービスの運営を妨害するおそれのある行為
7. 不正アクセスをし、またはこれを試みる行為
8. 他のユーザーに関する個人情報等を収集または蓄積する行為
9. 不正な目的を持って本サービスを利用する行為
10. その他、当社が不適切と判断する行為

## 第5条（本サービスの提供の停止等）

1. 当社は、以下のいずれかの事由があると判断した場合、ユーザーに事前に通知することなく本サービスの全部または一部の提供を停止または中断することができるものとします。
2. 本サービスにかかるコンピュータシステムの保守点検または更新を行う場合
3. 地震、落雷、火災、停電または天災などの不可抗力により、本サービスの提供が困難となった場合

## 第6条（免責事項）

1. 当社は、本サービスに事実上または法律上の瑕疵（安全性、信頼性、正確性、完全性、有効性、特定の目的への適合性、セキュリティなどに関する欠陥、エラーやバグ、権利侵害などを含みます）がないことを明示的にも黙示的にも保証しておりません。
2. 当社は、本サービスに起因してユーザーに生じたあらゆる損害について一切の責任を負いません。

## 第7条（サービス内容の変更等）

当社は、ユーザーに通知することなく、本サービスの内容を変更しまたは本サービスの提供を中止することができるものとし、これによってユーザーに生じた損害について一切の責任を負いません。

## 第8条（利用規約の変更）

当社は、必要と判断した場合には、ユーザーに通知することなくいつでも本規約を変更することができるものとします。なお、本規約の変更後、本サービスの利用を開始した場合には、当該ユーザーは変更後の規約に同意したものとみなします。

## 第9条（個人情報の取扱い）

当社は、本サービスの利用によって取得する個人情報については、当社「プライバシーポリシー」に従い適切に取り扱うものとします。

## 第10条（通知または連絡）

ユーザーと当社との間の通知または連絡は、当社の定める方法によって行うものとします。

## 第11条（準拠法・裁判管轄）

1. 本規約の解釈にあたっては、日本法を準拠法とします。
2. 本サービスに関して紛争が生じた場合には、当社の本店所在地を管轄する裁判所を専属的合意管轄とします。

以上
  `.trim()
};

/**
 * プライバシーポリシーの内容
 */
const PRIVACY_POLICY = {
  version: '1.0.0',
  effectiveDate: '2025-01-01',
  lastUpdated: '2025-01-01',
  content: `
# プライバシーポリシー

最終更新日: 2025年1月1日
バージョン: 1.0.0

## 1. はじめに

当社は、本サービスにおけるユーザーの個人情報の取扱いについて、以下のとおりプライバシーポリシー（以下「本ポリシー」といいます）を定めます。

## 2. 個人情報の定義

「個人情報」とは、個人情報保護法にいう「個人情報」を指すものとし、生存する個人に関する情報であって、当該情報に含まれる氏名、生年月日、住所、電話番号、連絡先その他の記述等により特定の個人を識別できる情報及び容貌、指紋、声紋にかかるデータ、及び健康保険証の保険者番号などの当該情報単体から特定の個人を識別できる情報（個人識別情報）を指します。

## 3. 個人情報の収集方法

当社は、ユーザーが利用登録をする際に氏名、生年月日、住所、電話番号、メールアドレス、銀行口座番号、クレジットカード番号、運転免許証番号などの個人情報をお尋ねすることがあります。また、ユーザーと提携先などとの間でなされたユーザーの個人情報を含む取引記録や決済に関する情報を、当社の提携先（情報提供元、広告主、広告配信先などを含みます。以下、｢提携先｣といいます。）などから収集することがあります。

## 4. 個人情報を収集・利用する目的

当社が個人情報を収集・利用する目的は、以下のとおりです。

1. 本サービスの提供・運営のため
2. ユーザーからのお問い合わせに回答するため（本人確認を行うことを含む）
3. ユーザーが利用中のサービスの新機能、更新情報、キャンペーン等及び当社が提供する他のサービスの案内のメールを送付するため
4. メンテナンス、重要なお知らせなど必要に応じたご連絡のため
5. 利用規約に違反したユーザーや、不正・不当な目的でサービスを利用しようとするユーザーの特定をし、ご利用をお断りするため
6. ユーザーにご自身の登録情報の閲覧や変更、削除、ご利用状況の閲覧を行っていただくため
7. 有料サービスにおいて、ユーザーに利用料金を請求するため
8. 上記の利用目的に付随する目的

## 5. 利用目的の変更

当社は、利用目的が変更前と関連性を有すると合理的に認められる場合に限り、個人情報の利用目的を変更するものとします。利用目的の変更を行った場合には、変更後の目的について、当社所定の方法により、ユーザーに通知し、または本ウェブサイト上に公表するものとします。

## 6. 個人情報の第三者提供

当社は、次に掲げる場合を除いて、あらかじめユーザーの同意を得ることなく、第三者に個人情報を提供することはありません。ただし、個人情報保護法その他の法令で認められる場合を除きます。

1. 人の生命、身体または財産の保護のために必要がある場合であって、本人の同意を得ることが困難であるとき
2. 公衆衛生の向上または児童の健全な育成の推進のために特に必要がある場合であって、本人の同意を得ることが困難であるとき
3. 国の機関もしくは地方公共団体またはその委託を受けた者が法令の定める事務を遂行することに対して協力する必要がある場合であって、本人の同意を得ることにより当該事務の遂行に支障を及ぼすおそれがあるとき
4. 予め次の事項を告知あるいは公表し、かつ当社が個人情報保護委員会に届出をしたとき

## 7. 個人情報の開示

当社は、本人から個人情報の開示を求められたときは、本人に対し、遅滞なくこれを開示します。ただし、開示することにより次のいずれかに該当する場合は、その全部または一部を開示しないこともあり、開示しない決定をした場合には、その旨を遅滞なく通知します。

1. 本人または第三者の生命、身体、財産その他の権利利益を害するおそれがある場合
2. 当社の業務の適正な実施に著しい支障を及ぼすおそれがある場合
3. その他法令に違反することとなる場合

## 8. 個人情報の訂正および削除

1. ユーザーは、当社の保有する自己の個人情報が誤った情報である場合には、当社が定める手続きにより、当社に対して個人情報の訂正、追加または削除（以下「訂正等」といいます）を請求することができます。
2. 当社は、ユーザーから前項の請求を受けてその請求に応じる必要があると判断した場合には、遅滞なく、当該個人情報の訂正等を行うものとします。

## 9. クッキー（Cookie）の使用について

当社は、ユーザーによりよいサービスを提供するため、クッキー（Cookie）を使用することがありますが、これにより個人を特定できる情報の収集を行えるものではなく、ユーザーのプライバシーを侵害することはございません。また、クッキーの受け入れを希望されない場合は、ブラウザの設定で変更することができます。

## 10. アクセス解析ツールについて

当社は、本サービスの利用状況を把握するため、Google Analyticsなどのアクセス解析ツールを利用しています。これらのツールでは、クッキーを使用して個人を特定する情報を含まずにログ情報を収集しています。収集される情報は、各ツールの利用規約およびプライバシーポリシーに基づいて管理されます。

## 11. プライバシーポリシーの変更

1. 本ポリシーの内容は、法令その他本ポリシーに別段の定めのある事項を除いて、ユーザーに通知することなく、変更することができるものとします。
2. 当社が別途定める場合を除いて、変更後のプライバシーポリシーは、本ウェブサイトに掲載したときから効力を生じるものとします。

## 12. お問い合わせ窓口

本ポリシーに関するお問い合わせは、下記の窓口までお願いいたします。

以上
  `.trim()
};

/**
 * GET /api/legal/terms
 * 利用規約を取得
 */
legalRouter.get('/terms', (req: Request, res: Response) => {
  try {
    res.json({
      ...TERMS_OF_SERVICE,
      type: 'terms'
    });
  } catch (error) {
    console.error('[Legal API] Error fetching terms:', error);
    res.status(500).json({
      error: 'Failed to fetch terms of service'
    });
  }
});

/**
 * GET /api/legal/privacy
 * プライバシーポリシーを取得
 */
legalRouter.get('/privacy', (req: Request, res: Response) => {
  try {
    res.json({
      ...PRIVACY_POLICY,
      type: 'privacy'
    });
  } catch (error) {
    console.error('[Legal API] Error fetching privacy policy:', error);
    res.status(500).json({
      error: 'Failed to fetch privacy policy'
    });
  }
});

/**
 * GET /api/legal/versions
 * 文書バージョン情報を取得
 */
legalRouter.get('/versions', (req: Request, res: Response) => {
  try {
    res.json({
      terms: {
        version: TERMS_OF_SERVICE.version,
        effectiveDate: TERMS_OF_SERVICE.effectiveDate,
        lastUpdated: TERMS_OF_SERVICE.lastUpdated
      },
      privacy: {
        version: PRIVACY_POLICY.version,
        effectiveDate: PRIVACY_POLICY.effectiveDate,
        lastUpdated: PRIVACY_POLICY.lastUpdated
      }
    });
  } catch (error) {
    console.error('[Legal API] Error fetching versions:', error);
    res.status(500).json({
      error: 'Failed to fetch document versions'
    });
  }
});

/**
 * GET /api/legal/all
 * すべての法的文書を一度に取得（初回アクセス時用）
 */
legalRouter.get('/all', (req: Request, res: Response) => {
  try {
    res.json({
      terms: TERMS_OF_SERVICE,
      privacy: PRIVACY_POLICY
    });
  } catch (error) {
    console.error('[Legal API] Error fetching all documents:', error);
    res.status(500).json({
      error: 'Failed to fetch legal documents'
    });
  }
});
