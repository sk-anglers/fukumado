# 16. ç®¡ç†ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆAdmin Dashboardï¼‰

## 16.1 æ¦‚è¦

### 16.1.1 ç›®çš„

**ãµãã¾ã©ï¼ç®¡ç†ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãµãã¾ã©ï¼ï¼‰ã®é‹ç”¨çŠ¶æ³ã‚’ç›£è¦–ãƒ»ç®¡ç†ã™ã‚‹ãŸã‚ã®ç®¡ç†è€…å°‚ç”¨Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

ä¸»ãªç›®çš„ï¼š
- ã‚·ã‚¹ãƒ†ãƒ ã®ç¨¼åƒçŠ¶æ³ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ç›£è¦–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£è¦–
- é…ä¿¡ãƒ‡ãƒ¼ã‚¿ã¨EventSubã®ç®¡ç†
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç®¡ç†
- ãƒ­ã‚°ã¨ã‚¨ãƒ©ãƒ¼ã®è¿½è·¡
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®åˆ¶å¾¡

### 16.1.2 ä¸»è¦æ©Ÿèƒ½ï¼ˆ15ã‚¿ãƒ–ï¼‰

1. **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆDashboardï¼‰** ğŸ“Š
   - ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ã®è¡¨ç¤º
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆæƒ…å ±
   - ç¨¼åƒçŠ¶æ³ã‚µãƒãƒªãƒ¼
   - ä¸»è¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å¯è¦–åŒ–

2. **PVçµ±è¨ˆï¼ˆPV Statsï¼‰** ğŸ“ˆ
   - ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼çµ±è¨ˆã®è¡¨ç¤º
   - æ—¥æ¬¡/é€±æ¬¡/æœˆæ¬¡ã®ã‚¢ã‚¯ã‚»ã‚¹æ•°
   - ãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¯ã‚»ã‚¹çŠ¶æ³

3. **ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ï¼ˆAnalyticsï¼‰** ğŸ“‰
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æ
   - ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯è¿½è·¡
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†æ
   - ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¿½è·¡

4. **ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†ï¼ˆSystemï¼‰** ğŸ’»
   - ã‚µãƒ¼ãƒãƒ¼ç¨¼åƒçŠ¶æ³ã®ç›£è¦–
   - ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ï¼ˆCPUã€ãƒ¡ãƒ¢ãƒªã€ãƒ‡ã‚£ã‚¹ã‚¯ï¼‰
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
   - ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª

5. **ã‚µãƒ¼ãƒãƒ¼ç›£è¦–ï¼ˆServerMonitorï¼‰** ğŸ–¥ï¸
   - ã‚µãƒ¼ãƒãƒ¼ãƒªã‚½ãƒ¼ã‚¹ã®è©³ç´°ç›£è¦–
   - ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†
   - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµ±è¨ˆ
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

6. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆSecurityï¼‰** ğŸ”’
   - ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´ã®è¿½è·¡
   - ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œã®æ¤œå‡º
   - IPã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®ç›£è¦–
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ”»æ’ƒæ¤œçŸ¥

7. **é…ä¿¡ç®¡ç†ï¼ˆStreamsï¼‰** ğŸ“º
   - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–é…ä¿¡ã®ä¸€è¦§
   - é…ä¿¡çµ±è¨ˆæƒ…å ±
   - é…ä¿¡è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°
   - é…ä¿¡å±¥æ­´

8. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆUsersï¼‰** ğŸ‘¥
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã¨è©³ç´°æƒ…å ±
   - èªè¨¼çŠ¶æ…‹ã®ç¢ºèª
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£è¿½è·¡
   - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†

9. **ãƒ­ã‚°é–²è¦§ï¼ˆLogsï¼‰** ğŸ“‹
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ã®è¡¨ç¤º
   - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è¿½è·¡
   - ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã®åˆ†æ
   - ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

10. **ç›£æŸ»ãƒ­ã‚°ï¼ˆAuditLogsï¼‰** ğŸ“œ
    - ç®¡ç†è€…æ“ä½œã®è¨˜éŒ²ã¨è¿½è·¡
    - æ“ä½œå±¥æ­´ã®æ¤œç´¢ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    - ç›£æŸ»ãƒ­ã‚°ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹

11. **ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆAlertsï¼‰** ğŸ””
    - ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã®ç®¡ç†
    - ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥è¨­å®š
    - é‡è¦åº¦åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    - ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèªã¨è§£æ±º

12. **EventSubç®¡ç†ï¼ˆEventSubï¼‰** ğŸ“¡
    - Twitch EventSubæ¥ç¶šçŠ¶æ³ã®ç›£è¦–
    - è³¼èª­ãƒãƒ£ãƒ³ãƒãƒ«ã®ç®¡ç†
    - æ¥ç¶šçµ±è¨ˆã¨ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£æƒ…å ±
    - EventSubèªè¨¼ç®¡ç†
    - Conduitçµ±åˆçŠ¶æ…‹ã®ç¢ºèª

13. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥/DBï¼ˆCacheï¼‰** ğŸ’¾
    - Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®çŠ¶æ…‹ç¢ºèª
    - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®æ¤œç´¢ã¨å‰Šé™¤
    - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã®åˆ†æ
    - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®ç›£è¦–
    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šçŠ¶æ…‹

14. **APIç›£è¦–ï¼ˆAPI Monitorï¼‰** ğŸŒ
    - Twitch APIãƒ¬ãƒ¼ãƒˆåˆ¶é™çŠ¶æ³
    - YouTube API ã‚¯ã‚©ãƒ¼ã‚¿ä½¿ç”¨çŠ¶æ³
    - APIå‘¼ã³å‡ºã—çµ±è¨ˆ
    - ã‚¨ãƒ©ãƒ¼ç‡ã®ç›£è¦–

15. **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼ˆMaintenanceï¼‰** ğŸ”§
    - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆ
    - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    - ã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•

### 16.1.3 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆadmin-webï¼‰
- **React 18.3.1** + **TypeScript 5.9.3**: å‹å®‰å…¨ãªUIé–‹ç™º
- **React Router 7.5.1**: SPA routing
- **CSS Modules**: ã‚¹ã‚³ãƒ¼ãƒ—åŒ–ã•ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°
- **Vite 6.2.2**: é«˜é€Ÿãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆadmin-serverï¼‰
- **Express 5.1.0**: APIã‚µãƒ¼ãƒãƒ¼
- **TypeScript 5.9.3**: å‹å®‰å…¨ãªé–‹ç™º
- **Basic Authentication**: ç®¡ç†è€…èªè¨¼
- **Redis**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°
- **dotenv**: ç’°å¢ƒå¤‰æ•°ç®¡ç†

#### é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«
- **REST API**: ç®¡ç†æ“ä½œã¨ãƒ‡ãƒ¼ã‚¿å–å¾—
- **HTTP Basic Auth**: ç®¡ç†è€…èªè¨¼
- **CORS**: ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶å¾¡

### 16.1.4 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   admin-web     â”‚  React SPA (Port 5174)
â”‚  (Frontend UI)  â”‚  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  - èªè¨¼ç®¡ç†
         â”‚ HTTP Basic Auth + REST API
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  admin-server   â”‚  Express API (Port 4001)
â”‚  (Proxy Layer)  â”‚  - èªè¨¼ãƒ¬ã‚¤ãƒ¤ãƒ¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ—ãƒ­ã‚­ã‚·
         â”‚ Internal HTTP
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     server      â”‚  Main Backend (Port 4000)
â”‚ (Main Backend)  â”‚  - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  - ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
```

**3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ©ç‚¹ï¼š**
1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®åˆ†é›¢**: ç®¡ç†æ©Ÿèƒ½ã‚’æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰åˆ†é›¢
2. **èªè¨¼ãƒ¬ã‚¤ãƒ¤ãƒ¼**: admin-serverã§èªè¨¼ã‚’ä¸€å…ƒç®¡ç†
3. **è² è·åˆ†æ•£**: ç®¡ç†æ“ä½œãŒæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«å½±éŸ¿ã‚’ä¸ãˆãªã„
4. **ç‹¬ç«‹ã—ãŸãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ**: ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ç‹¬ç«‹ã—ã¦ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½

---

## 16.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 16.2.1 å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç®¡ç†è€…ãƒ–ãƒ©ã‚¦ã‚¶                          â”‚
â”‚  http://localhost:5174 (admin-web)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP Basic Auth
                            â”‚ username: admin
                            â”‚ password: [ADMIN_PASSWORD]
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      admin-server                             â”‚
â”‚  Port: 4001                                                   â”‚
â”‚  - Basicèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢                                       â”‚
â”‚  - CORSãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢                                            â”‚
â”‚  - ãƒ—ãƒ­ã‚­ã‚·ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° (/api/admin/* â†’ server:4000)          â”‚
â”‚  - Twitch OAuth (unused, proxy pattern adopted)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Internal HTTP
                            â”‚ Basic Auth Forwarded
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         server                                â”‚
â”‚  Port: 4000                                                   â”‚
â”‚  - /api/admin/* ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ                                â”‚
â”‚  - EventSubManager                                            â”‚
â”‚  - StreamSyncService                                          â”‚
â”‚  - WebSocket Server                                           â”‚
â”‚  - Redis Cache                                                â”‚
â”‚  - Database Access                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 16.2.2 èªè¨¼ãƒ•ãƒ­ãƒ¼

#### Basicèªè¨¼ãƒ•ãƒ­ãƒ¼
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ admin-web ã«ã‚¢ã‚¯ã‚»ã‚¹
   â†“
2. App.tsx ãŒ localStorage ã‚’ãƒã‚§ãƒƒã‚¯
   - admin_username ãŒå­˜åœ¨ã—ãªã„ â†’ Login.tsx ã‚’è¡¨ç¤º
   â†“
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèªè¨¼æƒ…å ±ã‚’å…¥åŠ›
   â†“
4. apiClient.login() ã‚’å‘¼ã³å‡ºã—
   â†“
5. admin-server ãŒèªè¨¼æƒ…å ±ã‚’æ¤œè¨¼
   - ADMIN_USERNAME ã¨ ADMIN_PASSWORD ã‚’ç…§åˆ
   â†“
6. æˆåŠŸæ™‚: localStorage ã«èªè¨¼æƒ…å ±ã‚’ä¿å­˜
   å¤±æ•—æ™‚: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
   â†“
7. ä»¥é™ã®APIå‘¼ã³å‡ºã—ã« Basic Auth ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä»˜ä¸
```

#### Twitch OAuth ãƒ•ãƒ­ãƒ¼ï¼ˆEventSubç”¨ï¼‰
```
1. EventSubç®¡ç†ç”»é¢ã§ã€ŒTwitchãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
2. æœ¬ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆserver:4000ï¼‰ã® /auth/twitch?admin=true ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   â†“
3. server ãŒ admin=true ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œå‡º
   - req.session.isAdminAuth = true ã‚’ä¿å­˜
   â†“
4. Twitch OAuth ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèªè¨¼ã‚’æ‰¿èª
   â†“
6. Twitch ãŒ /auth/twitch/callback ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   â†“
7. server ãŒèªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã«äº¤æ›
   â†“
8. isAdminAuth ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯
   - true ã®å ´åˆ: EventSubManager ã«èªè¨¼æƒ…å ±ã‚’é€ä¿¡
   â†“
9. admin-web ã® /eventsub?twitch_auth=success ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   â†“
10. admin-web ãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œå‡ºã—ã¦æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
```

**Proxy Pattern ã®ç†ç”±ï¼š**
- Twitch Developer Console ã§è¤‡æ•°ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIã‚’ç™»éŒ²ã—ãŸå ´åˆã€æœ€åˆã®URIãŒå„ªå…ˆã•ã‚Œã‚‹
- `http://localhost:4000/auth/twitch/callback` ãŒå…ˆã«ç™»éŒ²ã•ã‚Œã¦ã„ãŸãŸã‚
- æ–°ã—ã„Twitchã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¦ã‚‚ã€EventSubã¯å…ƒã®Client IDã«ç´ã¥ã„ã¦ã„ã‚‹ãŸã‚ä¸å¯
- è§£æ±ºç­–ï¼šæœ¬ã‚µãƒ¼ãƒ“ã‚¹ã‚’OAuthãƒ—ãƒ­ã‚­ã‚·ã¨ã—ã¦ä½¿ç”¨ã—ã€`admin=true`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§åˆ†å²

### 16.2.3 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

#### èª­ã¿å–ã‚Šæ“ä½œï¼ˆGETï¼‰
```
admin-web â†’ admin-server â†’ server â†’ Redis/DB
            â†“
        Basic Auth æ¤œè¨¼
            â†“
        Authorization Header è»¢é€
            â†“
        ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”å´
```

#### æ›¸ãè¾¼ã¿æ“ä½œï¼ˆPOST/PUT/DELETEï¼‰
```
admin-web â†’ admin-server â†’ server â†’ Redis/DB
            â†“                â†“
        Basic Auth æ¤œè¨¼    ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
            â†“                â†“
        Authorization    ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ
            â†“                â†“
        ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´   çŠ¶æ…‹æ›´æ–°
```

### 16.2.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å±¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Basic Authentication (admin-server)       â”‚
â”‚  - ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ¤œè¨¼                     â”‚
â”‚  - 401 ã‚¨ãƒ©ãƒ¼æ™‚ã®è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: CORS (admin-server)                       â”‚
â”‚  - è¨±å¯ã‚ªãƒªã‚¸ãƒ³: http://localhost:5174              â”‚
â”‚  - è¨±å¯ãƒ¡ã‚½ãƒƒãƒ‰: GET, POST, PUT, DELETE, OPTIONS    â”‚
â”‚  - èªè¨¼æƒ…å ±ã®é€ä¿¡: true                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Internal Network (admin-server â†’ server)  â”‚
â”‚  - localhost å†…éƒ¨é€šä¿¡ã®ã¿                           â”‚
â”‚  - å¤–éƒ¨ã‹ã‚‰ã®ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: API Authorization (server)                â”‚
â”‚  - /api/admin/* ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 16.3 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

### 16.3.1 admin-webï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

```
C:\Users\s_kus\é–‹ç™º\admin-web\
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ common/              # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.tsx       # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ 
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.module.css
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx      # ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”‚   â””â”€â”€ Sidebar.module.css
â”‚   â”‚   â””â”€â”€ pages/               # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚       â”œâ”€â”€ Dashboard.tsx    # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ Dashboard.module.css
â”‚   â”‚       â”œâ”€â”€ PVStats.tsx      # PVçµ±è¨ˆãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ PVStats.module.css
â”‚   â”‚       â”œâ”€â”€ Analytics.tsx    # ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ Analytics.module.css
â”‚   â”‚       â”œâ”€â”€ System.tsx       # ã‚·ã‚¹ãƒ†ãƒ ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ System.module.css
â”‚   â”‚       â”œâ”€â”€ Security.tsx     # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ Security.module.css
â”‚   â”‚       â”œâ”€â”€ Streams.tsx      # é…ä¿¡ç®¡ç†ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ Streams.module.css
â”‚   â”‚       â”œâ”€â”€ Users.tsx        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ Users.module.css
â”‚   â”‚       â”œâ”€â”€ Logs.tsx         # ãƒ­ã‚°é–²è¦§ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ Logs.module.css
â”‚   â”‚       â”œâ”€â”€ EventSub.tsx     # EventSubç®¡ç†ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ EventSub.module.css
â”‚   â”‚       â”œâ”€â”€ Cache.tsx        # ã‚­ãƒ£ãƒƒã‚·ãƒ¥/DBãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ Cache.module.css
â”‚   â”‚       â”œâ”€â”€ ApiMonitor.tsx   # APIç›£è¦–ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ ApiMonitor.module.css
â”‚   â”‚       â”œâ”€â”€ Maintenance.tsx  # ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒšãƒ¼ã‚¸
â”‚   â”‚       â”œâ”€â”€ Maintenance.module.css
â”‚   â”‚       â””â”€â”€ index.ts         # ãƒšãƒ¼ã‚¸ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â””â”€â”€ apiClient.ts         # APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts             # å‹å®šç¾©
â”‚   â”œâ”€â”€ App.tsx                  # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ App.css
â”‚   â”œâ”€â”€ main.tsx                 # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ vite-env.d.ts
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.app.json
â”œâ”€â”€ tsconfig.node.json
â””â”€â”€ vite.config.ts               # Viteè¨­å®š
```

### 16.3.2 admin-serverï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ—ãƒ­ã‚­ã‚·ï¼‰

```
C:\Users\s_kus\é–‹ç™º\admin-server\
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ env.ts               # ç’°å¢ƒå¤‰æ•°è¨­å®š
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.ts              # Basicèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â””â”€â”€ cors.ts              # CORSãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ auth.ts              # Twitch OAuthï¼ˆæœªä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ index.ts                 # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ types.ts                 # å‹å®šç¾©
â”œâ”€â”€ .env                         # ç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

### 16.3.3 serverï¼ˆãƒ¡ã‚¤ãƒ³ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ - ç®¡ç†APIéƒ¨åˆ†ï¼‰

```
C:\Users\s_kus\é–‹ç™º\server\
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ auth.ts              # èªè¨¼ãƒ«ãƒ¼ãƒˆï¼ˆTwitch OAuth Proxyå«ã‚€ï¼‰
â”‚   â”‚   â””â”€â”€ eventsub.ts          # EventSubç®¡ç†API
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ twitchEventSubManager.ts  # EventSubç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â””â”€â”€ twitchAppAuth.ts     # Twitch Appèªè¨¼
â”‚   â””â”€â”€ index.ts                 # ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
```

---

## 16.4 ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 16.4.1 EventSubçµ±è¨ˆæƒ…å ±

**å‹å®šç¾©ï¼ˆ`admin-web/src/types/index.ts`ï¼‰:**

```typescript
export interface EventSubStatsResponse {
  success: boolean;
  data: {
    stats: {
      totalConnections: number;          // ç·æ¥ç¶šæ•°
      activeConnections: number;         // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šæ•°
      totalSubscriptions: number;        // ç·è³¼èª­æ•°
      subscribedChannelCount: number;    // è³¼èª­ãƒãƒ£ãƒ³ãƒãƒ«æ•°
      connections: Array<{
        index: number;                   // æ¥ç¶šã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0-2ï¼‰
        status: string;                  // æ¥ç¶šçŠ¶æ…‹
        subscriptionCount: number;       // è³¼èª­æ•°
        sessionId: string | null;        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ID
        connectedAt: string | null;      // æ¥ç¶šæ™‚åˆ»
      }>;
    };
    capacity: {
      total: number;                     // ç·å®¹é‡ï¼ˆ300ï¼‰
      used: number;                      // ä½¿ç”¨å®¹é‡
      available: number;                 // æ®‹ã‚Šå®¹é‡
      percentage: number;                // ä½¿ç”¨ç‡ï¼ˆ%ï¼‰
    };
  };
  timestamp: string;
}
```

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
GET /api/admin/eventsub/stats
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "success": true,
  "data": {
    "stats": {
      "totalConnections": 3,
      "activeConnections": 3,
      "totalSubscriptions": 6,
      "subscribedChannelCount": 3,
      "connections": [
        {
          "index": 0,
          "status": "connected",
          "subscriptionCount": 2,
          "sessionId": "AQoQILE7VHoLQ...",
          "connectedAt": "2025-10-27T10:30:45.123Z"
        }
      ]
    },
    "capacity": {
      "total": 300,
      "used": 6,
      "available": 294,
      "percentage": 2.0
    }
  },
  "timestamp": "2025-10-27T10:35:00.000Z"
}
```

### 16.4.2 EventSubè³¼èª­æƒ…å ±

**å‹å®šç¾©:**

```typescript
export interface EventSubSubscriptionsResponse {
  success: boolean;
  data: {
    totalChannels: number;               // ç·ãƒãƒ£ãƒ³ãƒãƒ«æ•°
    channelIds: string[];                // ãƒãƒ£ãƒ³ãƒãƒ«IDé…åˆ—
    subscriptions: Array<{
      connectionIndex: number;           // æ¥ç¶šã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
      status: string;                    // æ¥ç¶šçŠ¶æ…‹
      sessionId: string | null;          // ã‚»ãƒƒã‚·ãƒ§ãƒ³ID
      subscriptionCount: number;         // è³¼èª­æ•°
      subscribedUserIds: string[];       // è³¼èª­ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
    }>;
  };
  timestamp: string;
}
```

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:**
```
GET /api/admin/eventsub/subscriptions
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "success": true,
  "data": {
    "totalChannels": 3,
    "channelIds": ["123456789", "987654321", "555555555"],
    "subscriptions": [
      {
        "connectionIndex": 0,
        "status": "connected",
        "sessionId": "AQoQILE7VHoLQ...",
        "subscriptionCount": 2,
        "subscribedUserIds": ["123456789", "987654321"]
      }
    ]
  },
  "timestamp": "2025-10-27T10:35:00.000Z"
}
```

### 16.4.3 èªè¨¼æƒ…å ±

**ãƒ­ã‚°ã‚¤ãƒ³è¦æ±‚:**
```typescript
interface LoginRequest {
  username: string;
  password: string;
}
```

**ãƒ­ã‚°ã‚¤ãƒ³å¿œç­”:**
```typescript
interface LoginResponse {
  success: boolean;
  message: string;
}
```

---

## 16.5 èªè¨¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 16.5.1 Basicèªè¨¼

#### è¨­å®šï¼ˆ`admin-server/.env`ï¼‰

```env
ADMIN_USERNAME=admin
ADMIN_PASSWORD=AdminPassword123456!@$%
```

**æ³¨æ„äº‹é …:**
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã« `#` è¨˜å·ã‚’å«ã‚ãªã„ã“ã¨ï¼ˆdotenvãŒã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è§£é‡ˆï¼‰
- æœ€ä½16æ–‡å­—ä»¥ä¸Šã‚’æ¨å¥¨
- æœ¬ç•ªç’°å¢ƒã§ã¯å¼·åŠ›ãªãƒ©ãƒ³ãƒ€ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨

#### å®Ÿè£…ï¼ˆ`admin-server/src/middleware/auth.ts`ï¼‰

```typescript
import { Request, Response, NextFunction } from 'express';
import { env } from '../config/env';

export function basicAuthMiddleware(req: Request, res: Response, next: NextFunction) {
  const authHeader = req.headers.authorization;

  if (!authHeader || !authHeader.startsWith('Basic ')) {
    res.setHeader('WWW-Authenticate', 'Basic realm="Admin Dashboard"');
    return res.status(401).json({ error: 'Authentication required' });
  }

  const base64Credentials = authHeader.split(' ')[1];
  const credentials = Buffer.from(base64Credentials, 'base64').toString('utf-8');
  const [username, password] = credentials.split(':');

  if (username === env.adminUsername && password === env.adminPassword) {
    next();
  } else {
    res.setHeader('WWW-Authenticate', 'Basic realm="Admin Dashboard"');
    res.status(401).json({ error: 'Invalid credentials' });
  }
}
```

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆ`admin-web/src/services/apiClient.ts`ï¼‰

```typescript
async function makeRequest<T>(
  endpoint: string,
  options: RequestInit = {}
): Promise<T> {
  const username = localStorage.getItem('admin_username');
  const password = localStorage.getItem('admin_password');

  if (!username || !password) {
    throw new Error('Not authenticated');
  }

  const auth = btoa(`${username}:${password}`);

  const response = await fetch(`${API_BASE}${endpoint}`, {
    ...options,
    headers: {
      ...options.headers,
      'Authorization': `Basic ${auth}`,
      'Content-Type': 'application/json'
    }
  });

  if (!response.ok) {
    if (response.status === 401) {
      window.dispatchEvent(new Event('auth-error'));
      throw new Error('Authentication failed');
    }
    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
  }

  return response.json();
}
```

### 16.5.2 è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿæ§‹

**å®Ÿè£…ï¼ˆ`admin-web/src/App.tsx`ï¼‰:**

```typescript
useEffect(() => {
  const handleAuthError = () => {
    console.warn('[Auth] Authentication failed, logging out...');
    setIsAuthenticated(false);
    localStorage.removeItem('admin_username');
    localStorage.removeItem('admin_password');
  };

  window.addEventListener('auth-error', handleAuthError);

  return () => {
    window.removeEventListener('auth-error', handleAuthError);
  };
}, []);
```

**å‹•ä½œ:**
1. APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ401ã‚¨ãƒ©ãƒ¼ã‚’å—ä¿¡
2. `auth-error` ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
3. App.tsx ãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚­ãƒ£ãƒƒãƒ
4. èªè¨¼çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
5. ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º

### 16.5.3 CORSè¨­å®š

**å®Ÿè£…ï¼ˆ`admin-server/src/middleware/cors.ts`ï¼‰:**

```typescript
import cors from 'cors';

export const corsMiddleware = cors({
  origin: 'http://localhost:5174',  // admin-webã®URL
  credentials: true,                 // èªè¨¼æƒ…å ±ã®é€ä¿¡ã‚’è¨±å¯
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
});
```

### 16.5.4 ç’°å¢ƒå¤‰æ•°æ¤œè¨¼

**å®Ÿè£…ï¼ˆ`admin-server/src/config/env.ts`ï¼‰:**

```typescript
const requiredEnvVars = [
  'ADMIN_USERNAME',
  'ADMIN_PASSWORD',
  'MAIN_BACKEND_URL'
] as const;

// ç’°å¢ƒå¤‰æ•°ã®å­˜åœ¨ç¢ºèª
for (const varName of requiredEnvVars) {
  if (!process.env[varName]) {
    throw new Error(`Missing required environment variable: ${varName}`);
  }
}

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å¼·åº¦ãƒã‚§ãƒƒã‚¯
if (env.adminPassword.length < 16) {
  throw new Error('ADMIN_PASSWORD must be at least 16 characters');
}
```

---

## 16.6 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 16.6.1 Layoutï¼ˆ`components/common/Layout.tsx`ï¼‰

**è²¬å‹™:**
- å…¨ãƒšãƒ¼ã‚¸å…±é€šã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ 
- ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¨ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®é…ç½®

**æ§‹é€ :**
```typescript
export const Layout: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return (
    <div className={styles.layout}>
      <Sidebar />
      <main className={styles.main}>
        {children}
      </main>
    </div>
  );
};
```

### 16.6.2 Sidebarï¼ˆ`components/common/Sidebar.tsx`ï¼‰

**è²¬å‹™:**
- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è¡¨ç¤º
- ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ

**ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é …ç›®:**
```typescript
const navItems: NavItem[] = [
  { id: 'dashboard', label: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', path: '/', icon: 'ğŸ“Š' },
  { id: 'pv-stats', label: 'PVçµ±è¨ˆ', path: '/pv-stats', icon: 'ğŸ“ˆ' },
  { id: 'analytics', label: 'ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹', path: '/analytics', icon: 'ğŸ“‰' },
  { id: 'system', label: 'ã‚·ã‚¹ãƒ†ãƒ ', path: '/system', icon: 'ğŸ’»' },
  { id: 'server-monitor', label: 'ã‚µãƒ¼ãƒç›£è¦–', path: '/server-monitor', icon: 'ğŸ–¥ï¸' },
  { id: 'security', label: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£', path: '/security', icon: 'ğŸ”’' },
  { id: 'streams', label: 'é…ä¿¡ç®¡ç†', path: '/streams', icon: 'ğŸ“º' },
  { id: 'users', label: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†', path: '/users', icon: 'ğŸ‘¥' },
  { id: 'logs', label: 'ãƒ­ã‚°é–²è¦§', path: '/logs', icon: 'ğŸ“‹' },
  { id: 'audit-logs', label: 'ç›£æŸ»ãƒ­ã‚°', path: '/audit-logs', icon: 'ğŸ“œ' },
  { id: 'alerts', label: 'ã‚¢ãƒ©ãƒ¼ãƒˆ', path: '/alerts', icon: 'ğŸ””' },
  { id: 'eventsub', label: 'EventSubç®¡ç†', path: '/eventsub', icon: 'ğŸ“¡' },
  { id: 'cache', label: 'ã‚­ãƒ£ãƒƒã‚·ãƒ¥/DB', path: '/cache', icon: 'ğŸ’¾' },
  { id: 'api-monitor', label: 'APIç›£è¦–', path: '/api-monitor', icon: 'ğŸŒ' },
  { id: 'maintenance', label: 'ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹', path: '/maintenance', icon: 'ğŸ”§' }
];
```

### 16.6.3 Dashboardï¼ˆ`components/pages/Dashboard.tsx`ï¼‰

**è²¬å‹™:**
- ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ã‚µãƒãƒªãƒ¼è¡¨ç¤º
- é‡è¦æŒ‡æ¨™ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**ç¾åœ¨ã®å®Ÿè£…:**
```typescript
export const Dashboard: React.FC = () => {
  return (
    <div className={styles.container}>
      <h1 className={styles.title}>ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <p className={styles.subtitle}>ã‚·ã‚¹ãƒ†ãƒ ã®ç¨¼åƒçŠ¶æ³ã‚’ç¢ºèªã§ãã¾ã™</p>

      <div className={styles.grid}>
        <div className={styles.card}>
          <h2>ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹</h2>
          <div className={styles.status}>ğŸŸ¢ æ­£å¸¸ç¨¼åƒä¸­</div>
        </div>

        <div className={styles.card}>
          <h2>ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
          <Link to="/eventsub" className={styles.link}>
            EventSubç®¡ç†ã¸ â†’
          </Link>
        </div>
      </div>
    </div>
  );
};
```

### 16.6.4 EventSubï¼ˆ`components/pages/EventSub.tsx`ï¼‰

**è²¬å‹™:**
- EventSubæ¥ç¶šçŠ¶æ³ã®è¡¨ç¤º
- è³¼èª­ãƒãƒ£ãƒ³ãƒãƒ«ã®ç®¡ç†
- Twitchèªè¨¼ã®ç®¡ç†

**ä¸»è¦æ©Ÿèƒ½:**

1. **çµ±è¨ˆã‚«ãƒ¼ãƒ‰è¡¨ç¤º**
```typescript
<div className={styles.statsGrid}>
  <div className={styles.statCard}>
    <div className={styles.statLabel}>ç·æ¥ç¶šæ•°</div>
    <div className={styles.statValue}>{statsData.stats.totalConnections}</div>
    <div className={styles.statSubtext}>
      ã‚¢ã‚¯ãƒ†ã‚£ãƒ–: {statsData.stats.activeConnections}
    </div>
  </div>
  {/* ä»–ã®çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */}
</div>
```

2. **æ¥ç¶šçŠ¶æ³è¡¨ç¤º**
```typescript
<div className={styles.connectionsGrid}>
  {statsData.stats.connections.map((conn) => (
    <div key={conn.index} className={styles.connectionCard}>
      <div className={styles.connectionHeader}>
        <span className={styles.connectionIndex}>æ¥ç¶š #{conn.index}</span>
        <span className={`${styles.connectionStatus} ${styles[conn.status]}`}>
          {conn.status}
        </span>
      </div>
      {/* æ¥ç¶šè©³ç´° */}
    </div>
  ))}
</div>
```

3. **Twitchãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³**
```typescript
const handleTwitchLogin = () => {
  // æœ¬ã‚µãƒ¼ãƒ“ã‚¹çµŒç”±ã§èªè¨¼ï¼ˆadmin=trueãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä»˜ä¸ï¼‰
  window.location.href = 'http://localhost:4000/auth/twitch?admin=true';
};

{twitchUsername ? (
  <div className={styles.twitchStatus}>
    ğŸŸ¢ {twitchUsername}
  </div>
) : (
  <button onClick={handleTwitchLogin} className={styles.twitchLoginButton}>
    ğŸ”“ Twitchãƒ­ã‚°ã‚¤ãƒ³
  </button>
)}
```

4. **è³¼èª­è§£é™¤æ©Ÿèƒ½**
```typescript
const handleUnsubscribe = async (userId: string) => {
  if (!confirm(`ãƒãƒ£ãƒ³ãƒãƒ« ${userId} ã®è³¼èª­ã‚’è§£é™¤ã—ã¾ã™ã‹?`)) {
    return;
  }

  try {
    await unsubscribeEventSub(userId);
    await loadData();  // ãƒ‡ãƒ¼ã‚¿å†èª­ã¿è¾¼ã¿
  } catch (err) {
    console.error('Failed to unsubscribe:', err);
    alert('è³¼èª­è§£é™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};
```

5. **å†æ¥ç¶šæ©Ÿèƒ½**
```typescript
const handleReconnect = async () => {
  if (!confirm('EventSubã‚’å†æ¥ç¶šã—ã¾ã™ã‹?')) {
    return;
  }

  try {
    await reconnectEventSub();
    await loadData();
  } catch (err) {
    console.error('Failed to reconnect:', err);
    alert('å†æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};
```

6. **è‡ªå‹•æ›´æ–°**
```typescript
useEffect(() => {
  loadData();
  const interval = setInterval(loadData, 30000); // 30ç§’ã”ã¨ã«æ›´æ–°
  return () => clearInterval(interval);
}, []);
```

### 16.6.5 Loginï¼ˆ`components/pages/Login.tsx`ï¼‰

**è²¬å‹™:**
- ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º
- èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

**å®Ÿè£…:**
```typescript
export const Login: React.FC<LoginProps> = ({ onLogin }) => {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    try {
      await login(username, password);
      onLogin(username, password);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.loginBox}>
        <h1 className={styles.title}>ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
        <form onSubmit={handleSubmit}>
          {/* ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */}
        </form>
      </div>
    </div>
  );
};
```

### 16.6.6 PVStatsï¼ˆ`components/pages/PVStats.tsx`ï¼‰

**è²¬å‹™:**
- ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼çµ±è¨ˆã®è¡¨ç¤º
- æ™‚ç³»åˆ—ã‚°ãƒ©ãƒ•ã¨ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
- æ—¥æ¬¡ãƒ»é€±æ¬¡ãƒ»æœˆæ¬¡ã®PVãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–

**ä¸»è¦æ©Ÿèƒ½:**
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ PVã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º
- æœŸé–“åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ—¥æ¬¡ã€é€±æ¬¡ã€æœˆæ¬¡ï¼‰
- ã‚°ãƒ©ãƒ•è¡¨ç¤ºï¼ˆæŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã€æ£’ã‚°ãƒ©ãƒ•ï¼‰
- CSV/JSONã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½

### 16.6.7 Analyticsï¼ˆ`components/pages/Analytics.tsx`ï¼‰

**è²¬å‹™:**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•åˆ†æã®è¡¨ç¤º
- ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–
- ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯è¿½è·¡ã¨ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³åˆ†æ

**ä¸»è¦æ©Ÿèƒ½:**
- ã‚¤ãƒ™ãƒ³ãƒˆåˆ¥ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°çµ±è¨ˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†æ
- ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚¡ãƒãƒ«è¡¨ç¤º
- ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

### 16.6.8 Systemï¼ˆ`components/pages/System.tsx`ï¼‰

**è²¬å‹™:**
- ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®è¡¨ç¤º
- ã‚µãƒ¼ãƒãƒ¼ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

**ä¸»è¦æ©Ÿèƒ½:**
- CPUãƒ»ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡è¡¨ç¤º
- Redisæ¥ç¶šçŠ¶æ…‹
- WebSocketæ¥ç¶šæ•°
- ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ è¡¨ç¤º
- ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

### 16.6.9 Securityï¼ˆ`components/pages/Security.tsx`ï¼‰

**è²¬å‹™:**
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®ç›£è¦–
- ç•°å¸¸æ¤œçŸ¥ã‚¢ãƒ©ãƒ¼ãƒˆã®è¡¨ç¤º
- ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆç®¡ç†

**ä¸»è¦æ©Ÿèƒ½:**
- æ”»æ’ƒæ¤œçŸ¥ãƒ­ã‚°è¡¨ç¤º
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™é•åã®è¿½è·¡
- IPãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆç®¡ç†
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆã®å¯è¦–åŒ–
- ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œã®çµ±è¨ˆ

### 16.6.10 Streamsï¼ˆ`components/pages/Streams.tsx`ï¼‰

**è²¬å‹™:**
- é…ä¿¡ãƒªã‚¹ãƒˆã®ç®¡ç†
- é…ä¿¡åŒæœŸè¨­å®š
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†

**ä¸»è¦æ©Ÿèƒ½:**
- ç¾åœ¨é…ä¿¡ä¸­ã®ãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§
- é…ä¿¡ãƒªã‚¹ãƒˆã®æ‰‹å‹•åŒæœŸ
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢ã¨æ›´æ–°
- ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆYouTubeã€Twitchã€ãƒ‹ã‚³ãƒ‹ã‚³ï¼‰
- é…ä¿¡çµ±è¨ˆã®è¡¨ç¤º

### 16.6.11 Usersï¼ˆ`components/pages/Users.tsx`ï¼‰

**è²¬å‹™:**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
- ãƒ•ã‚©ãƒ­ãƒ¼ãƒãƒ£ãƒ³ãƒãƒ«ç®¡ç†
- OAuthèªè¨¼çŠ¶æ…‹ã®ç¢ºèª

**ä¸»è¦æ©Ÿèƒ½:**
- ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒ•ã‚©ãƒ­ãƒ¼ãƒãƒ£ãƒ³ãƒãƒ«è¡¨ç¤º
- OAuthèªè¨¼çŠ¶æ…‹ã®ç¢ºèª
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°

### 16.6.12 Logsï¼ˆ`components/pages/Logs.tsx`ï¼‰

**è²¬å‹™:**
- ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°ã®é–²è¦§
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åˆ¥è¡¨ç¤º

**ä¸»è¦æ©Ÿèƒ½:**
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
- ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆERRORã€WARNã€INFOã€DEBUGï¼‰
- æ™‚é–“ç¯„å›²æŒ‡å®š
- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢
- ãƒ­ã‚°ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆJSONã€ãƒ†ã‚­ã‚¹ãƒˆï¼‰

### 16.6.13 Cacheï¼ˆ`components/pages/Cache.tsx`ï¼‰

**è²¬å‹™:**
- Redisã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç®¡ç†
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çŠ¶æ…‹ã®ç¢ºèª
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã®ç›£è¦–

**ä¸»è¦æ©Ÿèƒ½:**
- Redisæ¥ç¶šçŠ¶æ…‹è¡¨ç¤º
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ä¸€è¦§
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ/ãƒŸã‚¹çµ±è¨ˆ
- å€‹åˆ¥ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
- å…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥TTLè¨­å®š

### 16.6.14 ApiMonitorï¼ˆ`components/pages/ApiMonitor.tsx`ï¼‰

**è²¬å‹™:**
- APIå‘¼ã³å‡ºã—çŠ¶æ³ã®ç›£è¦–
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã®è¿½è·¡
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ¥çµ±è¨ˆ

**ä¸»è¦æ©Ÿèƒ½:**
- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆåˆ¥ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
- å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ è¡¨ç¤º
- ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ¼ãƒˆç›£è¦–
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™çŠ¶æ…‹ã®ç¢ºèª
- APIä½¿ç”¨é‡ã‚°ãƒ©ãƒ•

### 16.6.15 Maintenanceï¼ˆ`components/pages/Maintenance.tsx`ï¼‰

**è²¬å‹™:**
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®ç®¡ç†
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥ã®è¨­å®š
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

**ä¸»è¦æ©Ÿèƒ½:**
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®ON/OFFåˆ‡ã‚Šæ›¿ãˆ
- ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç·¨é›†
- äºˆå®šçµ‚äº†æ™‚åˆ»ã®è¨­å®š
- ãƒã‚¤ãƒ‘ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

### 16.6.16 ServerMonitorï¼ˆ`components/pages/ServerMonitor.tsx`ï¼‰

**è²¬å‹™:**
- ã‚µãƒ¼ãƒãƒ¼ãƒªã‚½ãƒ¼ã‚¹ã®è©³ç´°ç›£è¦–
- ãƒ—ãƒ­ã‚»ã‚¹æƒ…å ±ã®è¡¨ç¤º
- ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®è¿½è·¡

**ä¸»è¦æ©Ÿèƒ½:**
- CPUä½¿ç”¨ç‡ã®è©³ç´°è¡¨ç¤º
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŠ¶æ³ã®ç›£è¦–
- ãƒ‡ã‚£ã‚¹ã‚¯I/Oçµ±è¨ˆ
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµ±è¨ˆ
- ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§ã¨ç®¡ç†
- ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ è¡¨ç¤º

### 16.6.17 AuditLogsï¼ˆ`components/pages/AuditLogs.tsx`ï¼‰

**è²¬å‹™:**
- ç®¡ç†è€…æ“ä½œã®è¨˜éŒ²ã¨è¿½è·¡
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹
- æ“ä½œå±¥æ­´ã®ç›£æŸ»

**ä¸»è¦æ©Ÿèƒ½:**
- ç›£æŸ»ãƒ­ã‚°ä¸€è¦§è¡¨ç¤ºï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰
- æ—¥æ™‚ç¯„å›²æŒ‡å®š
- ãƒ­ã‚°è©³ç´°è¡¨ç¤ºï¼ˆJSONå½¢å¼ï¼‰
- ç›£æŸ»ãƒ­ã‚°ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- å¤ã„ãƒ­ã‚°ã®è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«:**
```typescript
interface AuditLog {
  id: string;
  action: string;         // æ“ä½œç¨®åˆ¥
  actor: string;          // æ“ä½œè€…
  actorIp: string;        // IPã‚¢ãƒ‰ãƒ¬ã‚¹
  actorAgent?: string;    // User-Agent
  targetType: string;     // å¯¾è±¡ç¨®åˆ¥
  targetId?: string;      // å¯¾è±¡ID
  details?: any;          // è©³ç´°æƒ…å ±
  status: string;         // success/failure
  errorMessage?: string;  // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  createdAt: string;      // ä½œæˆæ—¥æ™‚
}
```

### 16.6.18 Alertsï¼ˆ`components/pages/Alerts.tsx`ï¼‰

**è²¬å‹™:**
- ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã®ç®¡ç†
- ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ã®è¨­å®š
- ã‚¢ãƒ©ãƒ¼ãƒˆã®ç¢ºèªã¨è§£æ±º

**ä¸»è¦æ©Ÿèƒ½:**
- ã‚¢ãƒ©ãƒ¼ãƒˆä¸€è¦§è¡¨ç¤ºï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
- ã‚¿ã‚¤ãƒ—åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆCPUé«˜ã€ãƒ¡ãƒ¢ãƒªé«˜ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ä½ç­‰ï¼‰
- é‡è¦åº¦åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆinfo/warning/error/criticalï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆæœªèª­/æœªè§£æ±º/å…¨ã¦ï¼‰
- ã‚¢ãƒ©ãƒ¼ãƒˆã®ç¢ºèªï¼ˆAcknowledgeï¼‰
- ã‚¢ãƒ©ãƒ¼ãƒˆã®è§£æ±ºï¼ˆResolveï¼‰
- ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šã®ç®¡ç†
- é€šçŸ¥è¨­å®šï¼ˆãƒ¡ãƒ¼ãƒ«/Slack/Webhookï¼‰

**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«:**
```typescript
interface Alert {
  id: string;
  type: string;           // cpu_high, memory_highç­‰
  severity: string;       // info, warning, error, critical
  title: string;          // ã‚¢ãƒ©ãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«
  message: string;        // ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  details?: any;          // è©³ç´°æƒ…å ±
  acknowledged: boolean;  // ç¢ºèªæ¸ˆã¿ãƒ•ãƒ©ã‚°
  acknowledgedAt?: string;
  acknowledgedBy?: string;
  resolved: boolean;      // è§£æ±ºæ¸ˆã¿ãƒ•ãƒ©ã‚°
  resolvedAt?: string;
  createdAt: string;
  updatedAt: string;
}

interface AlertSetting {
  id: number;
  type: string;           // ã‚¢ãƒ©ãƒ¼ãƒˆç¨®åˆ¥
  enabled: boolean;       // æœ‰åŠ¹/ç„¡åŠ¹
  threshold?: number;     // é–¾å€¤
  notifyEmail: boolean;   // ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
  notifySlack: boolean;   // Slacké€šçŸ¥
  notifyWebhook: boolean; // Webhooké€šçŸ¥
  createdAt: string;
  updatedAt: string;
}
```

---

## 16.7 APIä»•æ§˜

### 16.7.1 èªè¨¼API

#### POST /api/admin/login

**ç›®çš„:** ç®¡ç†è€…èªè¨¼

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "username": "admin",
  "password": "AdminPassword123456!@$%"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰:**
```json
{
  "success": true,
  "message": "Login successful"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆå¤±æ•—ï¼‰:**
```json
{
  "error": "Invalid credentials"
}
```

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰:**
- `200`: æˆåŠŸ
- `401`: èªè¨¼å¤±æ•—

---

### 16.7.2 EventSubç®¡ç†API

#### GET /api/admin/eventsub/stats

**ç›®çš„:** EventSubçµ±è¨ˆæƒ…å ±ã®å–å¾—

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "stats": {
      "totalConnections": 3,
      "activeConnections": 3,
      "totalSubscriptions": 6,
      "subscribedChannelCount": 3,
      "connections": [
        {
          "index": 0,
          "status": "connected",
          "subscriptionCount": 2,
          "sessionId": "AQoQILE7VHoLQ...",
          "connectedAt": "2025-10-27T10:30:45.123Z"
        }
      ]
    },
    "capacity": {
      "total": 300,
      "used": 6,
      "available": 294,
      "percentage": 2.0
    }
  },
  "timestamp": "2025-10-27T10:35:00.000Z"
}
```

**å®Ÿè£…ï¼ˆ`server/src/routes/eventsub.ts:10-31`ï¼‰:**
```typescript
eventsubRouter.get('/stats', async (req, res) => {
  try {
    const stats = twitchEventSubManager.getStats();
    const capacity = twitchEventSubManager.getCapacity();

    res.json({
      success: true,
      data: {
        stats,
        capacity
      },
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('[EventSub] Error getting stats:', error);
    res.status(500).json({
      success: false,
      error: 'Internal server error',
      timestamp: new Date().toISOString()
    });
  }
});
```

---

#### GET /api/admin/eventsub/subscriptions

**ç›®çš„:** è³¼èª­ãƒãƒ£ãƒ³ãƒãƒ«ä¸€è¦§ã®å–å¾—

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "totalChannels": 3,
    "channelIds": ["123456789", "987654321", "555555555"],
    "subscriptions": [
      {
        "connectionIndex": 0,
        "status": "connected",
        "sessionId": "AQoQILE7VHoLQ...",
        "subscriptionCount": 2,
        "subscribedUserIds": ["123456789", "987654321"]
      }
    ]
  },
  "timestamp": "2025-10-27T10:35:00.000Z"
}
```

**å®Ÿè£…ï¼ˆ`server/src/routes/eventsub.ts:37-68`ï¼‰:**
```typescript
eventsubRouter.get('/subscriptions', async (req, res) => {
  try {
    const channelIds = twitchEventSubManager.getSubscribedUserIds();
    const stats = twitchEventSubManager.getStats();

    const subscriptions = stats.connections.map((conn) => ({
      connectionIndex: conn.index,
      status: conn.status,
      sessionId: conn.sessionId,
      subscriptionCount: conn.subscriptionCount,
      subscribedUserIds: conn.subscribedUserIds
    }));

    res.json({
      success: true,
      data: {
        totalChannels: channelIds.length,
        channelIds,
        subscriptions
      },
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('[EventSub] Error getting subscriptions:', error);
    res.status(500).json({
      success: false,
      error: 'Internal server error',
      timestamp: new Date().toISOString()
    });
  }
});
```

---

#### DELETE /api/admin/eventsub/subscriptions/:userId

**ç›®çš„:** ç‰¹å®šãƒãƒ£ãƒ³ãƒãƒ«ã®è³¼èª­è§£é™¤

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `userId`: Twitchãƒ¦ãƒ¼ã‚¶ãƒ¼ID

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "userId": "123456789",
    "unsubscribed": true
  },
  "timestamp": "2025-10-27T10:35:00.000Z"
}
```

**å®Ÿè£…ï¼ˆ`server/src/routes/eventsub.ts:74-97`ï¼‰:**
```typescript
eventsubRouter.delete('/subscriptions/:userId', async (req, res) => {
  try {
    const { userId } = req.params;

    await twitchEventSubManager.unsubscribeChannel(userId);
    console.log(`[EventSub] Unsubscribed channel: ${userId}`);

    res.json({
      success: true,
      data: {
        userId,
        unsubscribed: true
      },
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error(`[EventSub] Error unsubscribing channel:`, error);
    res.status(500).json({
      success: false,
      error: 'Internal server error',
      timestamp: new Date().toISOString()
    });
  }
});
```

---

#### POST /api/admin/eventsub/reconnect

**ç›®çš„:** å…¨æ¥ç¶šã®å†æ¥ç¶š

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "reconnected": true
  },
  "timestamp": "2025-10-27T10:35:00.000Z"
}
```

**å®Ÿè£…ï¼ˆ`server/src/routes/eventsub.ts:103-123`ï¼‰:**
```typescript
eventsubRouter.post('/reconnect', async (req, res) => {
  try {
    console.log('[EventSub] Reconnecting all connections...');
    await twitchEventSubManager.reconnectAll();

    res.json({
      success: true,
      data: {
        reconnected: true
      },
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('[EventSub] Error reconnecting:', error);
    res.status(500).json({
      success: false,
      error: 'Internal server error',
      timestamp: new Date().toISOString()
    });
  }
});
```

---

#### POST /api/admin/eventsub/subscribe

**ç›®çš„:** ãƒãƒ£ãƒ³ãƒãƒ«ã®è³¼èª­ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "userId": "123456789"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "userId": "123456789",
    "subscribed": true
  },
  "timestamp": "2025-10-27T10:35:00.000Z"
}
```

**å®Ÿè£…ï¼ˆ`server/src/routes/eventsub.ts:130-161`ï¼‰:**
```typescript
eventsubRouter.post('/subscribe', async (req, res) => {
  try {
    const { userId } = req.body;

    if (!userId) {
      return res.status(400).json({
        success: false,
        error: 'userId is required',
        timestamp: new Date().toISOString()
      });
    }

    console.log(`[EventSub] Subscribing to user: ${userId}`);
    await twitchEventSubManager.subscribeToUsers([userId]);

    res.json({
      success: true,
      data: {
        userId,
        subscribed: true
      },
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error(`[EventSub] Error subscribing to user:`, error);
    res.status(500).json({
      success: false,
      error: 'Internal server error',
      timestamp: new Date().toISOString()
    });
  }
});
```

---

### 16.7.3 ç›£æŸ»ãƒ­ã‚°ç®¡ç†API

#### GET /api/admin/audit-logs

**ç›®çš„:** ç›£æŸ»ãƒ­ã‚°ä¸€è¦§ã®å–å¾—

**èªè¨¼:** Basic Auth å¿…é ˆ

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `action` (optional): ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç¨®åˆ¥ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- `status` (optional): ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆsuccess/failureï¼‰
- `limit` (optional): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰
- `offset` (optional): ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "logs": [
      {
        "id": "123456",
        "action": "maintenance_enabled",
        "actor": "admin",
        "actorIp": "192.168.1.1",
        "actorAgent": "Mozilla/5.0...",
        "targetType": "maintenance",
        "targetId": null,
        "details": {
          "message": "ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Ÿæ–½ä¸­"
        },
        "status": "success",
        "errorMessage": null,
        "createdAt": "2025-11-04T10:00:00.000Z"
      }
    ],
    "total": 150,
    "limit": 50,
    "offset": 0
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### GET /api/admin/audit-logs/summary

**ç›®çš„:** ç›£æŸ»ãƒ­ã‚°ã®ã‚µãƒãƒªãƒ¼æƒ…å ±å–å¾—

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "totalLogs": 150,
    "successCount": 145,
    "failureCount": 5,
    "recentActions": [
      { "action": "maintenance_enabled", "count": 10 },
      { "action": "cache_cleared", "count": 25 }
    ],
    "topActors": [
      { "actor": "admin", "count": 100 }
    ]
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### POST /api/admin/audit-logs/cleanup

**ç›®çš„:** å¤ã„ç›£æŸ»ãƒ­ã‚°ã®å‰Šé™¤

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "days": 30
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "deletedCount": 50
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

### 16.7.4 ã‚¢ãƒ©ãƒ¼ãƒˆç®¡ç†API

#### GET /api/admin/alerts

**ç›®çš„:** ã‚¢ãƒ©ãƒ¼ãƒˆä¸€è¦§ã®å–å¾—

**èªè¨¼:** Basic Auth å¿…é ˆ

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `type` (optional): ã‚¢ãƒ©ãƒ¼ãƒˆã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- `severity` (optional): é‡è¦åº¦ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- `acknowledged` (optional): ç¢ºèªæ¸ˆã¿ãƒ•ãƒ©ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- `resolved` (optional): è§£æ±ºæ¸ˆã¿ãƒ•ãƒ©ã‚°ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- `limit` (optional): å–å¾—ä»¶æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 50ï¼‰
- `offset` (optional): ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "alerts": [
      {
        "id": "789",
        "type": "cpu_high",
        "severity": "warning",
        "title": "CPUä½¿ç”¨ç‡ãŒé«˜ããªã£ã¦ã„ã¾ã™",
        "message": "CPUä½¿ç”¨ç‡ãŒ85%ã«é”ã—ã¾ã—ãŸ",
        "details": {
          "cpuUsage": 85.5,
          "timestamp": "2025-11-04T09:55:00.000Z"
        },
        "acknowledged": false,
        "acknowledgedAt": null,
        "acknowledgedBy": null,
        "resolved": false,
        "resolvedAt": null,
        "createdAt": "2025-11-04T09:55:00.000Z",
        "updatedAt": "2025-11-04T09:55:00.000Z"
      }
    ],
    "total": 25,
    "limit": 50,
    "offset": 0
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### GET /api/admin/alerts/unread-count

**ç›®çš„:** æœªèª­ã‚¢ãƒ©ãƒ¼ãƒˆæ•°ã®å–å¾—

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "count": 5
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### POST /api/admin/alerts/:id/acknowledge

**ç›®çš„:** ã‚¢ãƒ©ãƒ¼ãƒˆã®ç¢ºèª

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `id`: ã‚¢ãƒ©ãƒ¼ãƒˆID

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "acknowledgedBy": "admin"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "id": "789",
    "acknowledged": true,
    "acknowledgedAt": "2025-11-04T10:00:00.000Z",
    "acknowledgedBy": "admin"
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### POST /api/admin/alerts/:id/resolve

**ç›®çš„:** ã‚¢ãƒ©ãƒ¼ãƒˆã®è§£æ±º

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `id`: ã‚¢ãƒ©ãƒ¼ãƒˆID

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "id": "789",
    "resolved": true,
    "resolvedAt": "2025-11-04T10:00:00.000Z"
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### GET /api/admin/alert-settings

**ç›®çš„:** ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šä¸€è¦§ã®å–å¾—

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "settings": [
      {
        "id": 1,
        "type": "cpu_high",
        "enabled": true,
        "threshold": 80.0,
        "notifyEmail": false,
        "notifySlack": false,
        "notifyWebhook": false,
        "createdAt": "2025-11-04T00:00:00.000Z",
        "updatedAt": "2025-11-04T00:00:00.000Z"
      }
    ]
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### PUT /api/admin/alert-settings/:type

**ç›®çš„:** ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šã®æ›´æ–°

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `type`: ã‚¢ãƒ©ãƒ¼ãƒˆã‚¿ã‚¤ãƒ—

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "enabled": true,
  "threshold": 85.0,
  "notifyEmail": true,
  "notifySlack": false,
  "notifyWebhook": false
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "type": "cpu_high",
    "enabled": true,
    "threshold": 85.0,
    "notifyEmail": true,
    "notifySlack": false,
    "notifyWebhook": false,
    "updatedAt": "2025-11-04T10:00:00.000Z"
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

### 16.7.5 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³API

#### POST /api/admin/database/migrate-audit-logs

**ç›®çš„:** audit_logsãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "message": "Audit logs table created successfully",
    "tables": ["audit_logs"]
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### POST /api/admin/database/migrate-alerts

**ç›®çš„:** alerts ã¨ alert_settings ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ

**èªè¨¼:** Basic Auth å¿…é ˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "message": "Alerts tables created successfully",
    "tables": ["alerts", "alert_settings"]
  },
  "timestamp": "2025-11-04T10:00:00.000Z"
}
```

---

#### POST /api/admin/eventsub/credentials

**ç›®çš„:** EventSubèªè¨¼æƒ…å ±ã®è¨­å®š

**èªè¨¼:** ãªã—ï¼ˆå†…éƒ¨APIï¼‰

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "accessToken": "abcdef123456...",
  "clientId": "mc01db35sug2j2t5cdekyid3favu2m"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "success": true,
  "data": {
    "updated": true
  },
  "timestamp": "2025-10-27T10:35:00.000Z"
}
```

**å®Ÿè£…ï¼ˆ`server/src/routes/eventsub.ts:168-205`ï¼‰:**
```typescript
eventsubRouter.post('/credentials', async (req, res) => {
  try {
    const { accessToken, clientId } = req.body;

    if (!accessToken || !clientId) {
      return res.status(400).json({
        success: false,
        error: 'accessToken and clientId are required',
        timestamp: new Date().toISOString()
      });
    }

    console.log('[EventSub] Setting new credentials...');

    // èªè¨¼æƒ…å ±ã‚’è¨­å®š
    twitchEventSubManager.setCredentials(accessToken, clientId);

    // å…¨æ¥ç¶šã‚’å†æ¥ç¶š
    await twitchEventSubManager.reconnectAll();

    console.log('[EventSub] Credentials updated and connections reestablished');

    res.json({
      success: true,
      data: {
        updated: true
      },
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('[EventSub] Error setting credentials:', error);
    res.status(500).json({
      success: false,
      error: 'Internal server error',
      timestamp: new Date().toISOString()
    });
  }
});
```

**å‘¼ã³å‡ºã—å…ƒï¼ˆ`server/src/routes/auth.ts:160-181`ï¼‰:**
```typescript
// ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ã®èªè¨¼ã®å ´åˆ
if (isAdminAuth) {
  console.log('[Twitch Callback] Admin authentication - sending credentials to admin dashboard');

  // ãƒˆãƒ¼ã‚¯ãƒ³ã‚’EventSubManagerã«é€ä¿¡
  try {
    const { fetch } = await import('undici');
    const response = await fetch('http://localhost:4000/api/admin/eventsub/credentials', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        accessToken: tokenResponse.access_token,
        clientId: process.env.TWITCH_CLIENT_ID
      })
    });

    if (response.ok) {
      console.log('[Twitch Callback] Credentials sent to EventSubManager successfully');
    } else {
      console.error('[Twitch Callback] Failed to send credentials:', response.status);
    }
  } catch (error) {
    console.error('[Twitch Callback] Error sending credentials:', error);
  }

  // ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  return res.redirect(`http://localhost:5174/eventsub?twitch_auth=success&username=${encodeURIComponent(userInfo.login)}`);
}
```

---

## 16.8 EventSubçµ±åˆ

### 16.8.1 EventSubManagerã®æ¦‚è¦

**å ´æ‰€:** `server/src/services/twitchEventSubManager.ts`

**ç›®çš„:**
- Twitch EventSub WebSocketã¨ã®æ¥ç¶šç®¡ç†
- 3ã¤ã®åŒæ™‚æ¥ç¶šã‚’ç¶­æŒï¼ˆå„æ¥ç¶šã§æœ€å¤§100è³¼èª­ï¼‰
- é…ä¿¡ã®é–‹å§‹/çµ‚äº†ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å—ä¿¡

**ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:**

```typescript
class TwitchEventSubManager {
  // èªè¨¼æƒ…å ±ã®è¨­å®š
  setCredentials(accessToken: string, clientId: string): void

  // å…¨æ¥ç¶šã®ç¢ºç«‹
  async connectAll(): Promise<void>

  // å…¨æ¥ç¶šã®åˆ‡æ–­
  disconnectAll(): void

  // å…¨æ¥ç¶šã®å†æ¥ç¶šï¼ˆè³¼èª­ã‚‚å¾©å…ƒï¼‰
  async reconnectAll(): Promise<void>

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®è³¼èª­
  async subscribeToUsers(userIds: string[]): Promise<void>

  // ãƒãƒ£ãƒ³ãƒãƒ«ã®è³¼èª­è§£é™¤
  async unsubscribeChannel(userId: string): Promise<void>

  // çµ±è¨ˆæƒ…å ±ã®å–å¾—
  getStats(): EventSubStats

  // å®¹é‡æƒ…å ±ã®å–å¾—
  getCapacity(): CapacityInfo

  // è³¼èª­ãƒ¦ãƒ¼ã‚¶ãƒ¼IDä¸€è¦§ã®å–å¾—
  getSubscribedUserIds(): string[]
}
```

### 16.8.2 reconnectAll()ã®å®Ÿè£…

**ã‚³ãƒ¼ãƒ‰ï¼ˆ`server/src/services/twitchEventSubManager.ts:219-246`ï¼‰:**

```typescript
/**
 * å…¨ã¦ã®æ¥ç¶šã‚’å†æ¥ç¶š
 */
public async reconnectAll(): Promise<void> {
  if (!this.accessToken || !this.clientId) {
    throw new Error('Credentials not set. Call setCredentials() first.');
  }

  console.log('[EventSub Manager] Reconnecting all connections...');

  // ç¾åœ¨ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ä¿å­˜
  const subscribedUserIds = Array.from(this.channelToConnectionMap.keys());
  console.log(`[EventSub Manager] Saving ${subscribedUserIds.length} subscriptions before reconnect`);

  // å…¨ã¦ã®æ¥ç¶šã‚’åˆ‡æ–­
  this.disconnectAll();

  // å…¨ã¦ã®æ¥ç¶šã‚’å†æ¥ç¶š
  await this.connectAll();

  // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¾©å…ƒ
  if (subscribedUserIds.length > 0) {
    console.log(`[EventSub Manager] Restoring ${subscribedUserIds.length} subscriptions...`);
    await this.subscribeToUsers(subscribedUserIds);
  }

  console.log('[EventSub Manager] Reconnection completed');
}
```

**å‹•ä½œãƒ•ãƒ­ãƒ¼:**
1. èªè¨¼æƒ…å ±ã®ç¢ºèª
2. ç¾åœ¨ã®è³¼èª­ãƒãƒ£ãƒ³ãƒãƒ«IDã‚’ä¿å­˜
3. å…¨æ¥ç¶šã‚’åˆ‡æ–­
4. å…¨æ¥ç¶šã‚’å†ç¢ºç«‹
5. ä¿å­˜ã—ãŸè³¼èª­ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å¾©å…ƒ

### 16.8.3 å®¹é‡ç®¡ç†

**ä»•æ§˜:**
- 1æ¥ç¶šã‚ãŸã‚Šæœ€å¤§100è³¼èª­
- åˆè¨ˆ3æ¥ç¶šã§æœ€å¤§300è³¼èª­
- `stream.online` ã¨ `stream.offline` ã§å„1è³¼èª­ï¼ˆ1ãƒãƒ£ãƒ³ãƒãƒ« = 2è³¼èª­ï¼‰

**å®¹é‡è¨ˆç®—:**
```typescript
public getCapacity(): CapacityInfo {
  const totalCapacity = this.connections.length * 100;  // 300
  const usedCapacity = this.connections.reduce(
    (sum, conn) => sum + conn.subscriptionCount,
    0
  );

  return {
    total: totalCapacity,
    used: usedCapacity,
    available: totalCapacity - usedCapacity,
    percentage: (usedCapacity / totalCapacity) * 100
  };
}
```

### 16.8.4 Twitch OAuthèªè¨¼ãƒ•ãƒ­ãƒ¼

**ç›®çš„:** User Access Tokenã®å–å¾—

**ç†ç”±:** WebSocket EventSubã¯User Access TokenãŒå¿…é ˆ
- App Access Tokenã§ã¯ `stream.online/offline` ã®è³¼èª­ãŒä¸å¯

**ãƒ•ãƒ­ãƒ¼:**
```
1. admin-web: EventSubç”»é¢ã§ã€ŒTwitchãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
2. window.location.href = 'http://localhost:4000/auth/twitch?admin=true'
   â†“
3. server: admin=true ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œå‡º
   - req.session.isAdminAuth = true
   â†“
4. server: Twitch OAuthç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   - https://id.twitch.tv/oauth2/authorize?...
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼: Twitchã§èªè¨¼ã‚’æ‰¿èª
   â†“
6. Twitch: /auth/twitch/callback ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   â†“
7. server: èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã«äº¤æ›
   â†“
8. server: isAdminAuth ãƒ•ãƒ©ã‚°ã‚’ãƒã‚§ãƒƒã‚¯
   - true ã®å ´åˆã®å‡¦ç†:
     a. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’EventSubManagerã«é€ä¿¡
        POST http://localhost:4000/api/admin/eventsub/credentials
     b. EventSubManager.setCredentials(token, clientId)
     c. EventSubManager.reconnectAll()
   â†“
9. server: admin-webã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
   - http://localhost:5174/eventsub?twitch_auth=success&username=...
   â†“
10. admin-web: URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œå‡º
    - æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
```

**å®Ÿè£…ç®‡æ‰€:**
- `admin-web/src/components/pages/EventSub.tsx:67-70` - ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³
- `server/src/routes/auth.ts:87-103` - adminæ¤œå‡º
- `server/src/routes/auth.ts:152-184` - èªè¨¼å¾Œå‡¦ç†
- `server/src/routes/eventsub.ts:168-205` - èªè¨¼æƒ…å ±è¨­å®š

---

## 16.9 é–‹ç™ºã‚¬ã‚¤ãƒ‰

### 16.9.1 ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 1. å‰ææ¡ä»¶
- Node.js 18ä»¥ä¸Š
- Redisï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã¾ãŸã¯Dockerã§èµ·å‹•ï¼‰
- Twitch Developer ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

#### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

**server/.env:**
```env
PORT=4000
NODE_ENV=development

# Twitch OAuth
TWITCH_CLIENT_ID=mc01db35sug2j2t5cdekyid3favu2m
TWITCH_CLIENT_SECRET=9r5cc8pv5638xdve5hyb2341cr0irn
TWITCH_REDIRECT_URI=http://localhost:4000/auth/twitch/callback

# Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
GOOGLE_REDIRECT_URI=http://localhost:4000/auth/google/callback

# Session
SESSION_SECRET=your_session_secret_here_min_32_chars

# Redis
REDIS_URL=redis://localhost:6379

# EventSub
ENABLE_EVENT_SUB=true
```

**admin-server/.env:**
```env
PORT=4001

# Admin Authentication
ADMIN_USERNAME=admin
ADMIN_PASSWORD=AdminPassword123456!@$%

# Redis
REDIS_URL=redis://localhost:6379

# Main Backend URL
MAIN_BACKEND_URL=http://localhost:4000

# Twitch OAuth (æœªä½¿ç”¨ã ãŒè¨­å®šå¿…è¦)
TWITCH_CLIENT_ID=mc01db35sug2j2t5cdekyid3favu2m
TWITCH_CLIENT_SECRET=9r5cc8pv5638xdve5hyb2341cr0irn
TWITCH_REDIRECT_URI=http://localhost:4001/auth/twitch/callback
SESSION_SECRET=3TWfDsJPjoAR4UGRFf8ERel0G3rWCbaKIiKxNot3qAJzTg067wqqLPdnXu2UOXfe
```

#### 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼
cd C:\Users\s_kus\é–‹ç™º\server
npm install

# ç®¡ç†ã‚µãƒ¼ãƒãƒ¼
cd C:\Users\s_kus\é–‹ç™º\admin-server
npm install

# ç®¡ç†ã‚¦ã‚§ãƒ–
cd C:\Users\s_kus\é–‹ç™º\admin-web
npm install
```

#### 4. ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ï¼ˆãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒãƒ¼ï¼‰:**
```bash
cd C:\Users\s_kus\é–‹ç™º\server
npm run dev
```

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ï¼ˆç®¡ç†ã‚µãƒ¼ãƒãƒ¼ï¼‰:**
```bash
cd C:\Users\s_kus\é–‹ç™º\admin-server
npm run dev
```

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3ï¼ˆç®¡ç†ã‚¦ã‚§ãƒ–ï¼‰:**
```bash
cd C:\Users\s_kus\é–‹ç™º\admin-web
npm run dev
```

#### 5. ã‚¢ã‚¯ã‚»ã‚¹

- **admin-web:** http://localhost:5174
- **admin-server:** http://localhost:4001
- **server:** http://localhost:4000

### 16.9.2 é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¿½åŠ 
```bash
# æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ
cd admin-web/src/components/pages
# System.tsx ã¨ System.module.css ã‚’ä½œæˆ

# Sidebar ã«ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ 
# admin-web/src/components/common/Sidebar.tsx

# App.tsx ã«ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ 
# admin-web/src/App.tsx
```

#### APIè¿½åŠ 
```bash
# serverå´ã«ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ 
# server/src/routes/admin.ts ãªã©

# admin-webã®apiClientã«é–¢æ•°ã‚’è¿½åŠ 
# admin-web/src/services/apiClient.ts

# å‹å®šç¾©ã‚’è¿½åŠ 
# admin-web/src/types/index.ts
```

### 16.9.3 ãƒ“ãƒ«ãƒ‰

```bash
# admin-web
cd admin-web
npm run build
# dist/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å‡ºåŠ›

# admin-server
cd admin-server
npm run build
# dist/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å‡ºåŠ›
```

---

## 16.10 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 16.10.1 ç„¡é™ãƒ­ã‚°ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—

**ç—‡çŠ¶:**
- ãƒ­ã‚°ã‚¤ãƒ³ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒç„¡é™ã«è¡¨ç¤ºã•ã‚Œã‚‹
- æ­£ã—ã„èªè¨¼æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã‚‚æˆåŠŸã—ãªã„

**åŸå› 1: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã« `#` è¨˜å·ãŒå«ã¾ã‚Œã¦ã„ã‚‹**

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ `#` ãŒã‚³ãƒ¡ãƒ³ãƒˆè¨˜å·ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹ãŸã‚ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé€”ä¸­ã§åˆ‡ã‚Œã‚‹ã€‚

**è§£æ±ºç­–:**
```bash
# admin-server/.env
# âŒ æ‚ªã„ä¾‹
ADMIN_PASSWORD="MX!+Fr87Dn#abuc3Zu4F*sqh"  # '#' ä»¥é™ãŒç„¡è¦–ã•ã‚Œã‚‹

# âœ… è‰¯ã„ä¾‹
ADMIN_PASSWORD=AdminPassword123456!@$%  # '#' ã‚’å«ã¾ãªã„
```

**åŸå› 2: localStorage ã«å¤ã„èªè¨¼æƒ…å ±ãŒæ®‹ã£ã¦ã„ã‚‹**

èªè¨¼æƒ…å ±å¤‰æ›´å¾Œã‚‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®localStorageã«å¤ã„èªè¨¼æƒ…å ±ãŒæ®‹ã£ã¦ã„ã‚‹ã€‚

**è§£æ±ºç­–:**
```javascript
// ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
localStorage.removeItem('admin_username');
localStorage.removeItem('admin_password');
// ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰
```

**åŸå› 3: admin-serverã®èµ·å‹•å¤±æ•—**

ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒ16æ–‡å­—æœªæº€ã§èµ·å‹•æ™‚ã‚¨ãƒ©ãƒ¼ã€‚

**ç¢ºèªæ–¹æ³•:**
```bash
# admin-serverã®ãƒ­ã‚°ã‚’ç¢ºèª
cd admin-server
npm run dev
# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
```

### 16.10.2 EventSub 500ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
- `/api/admin/eventsub/subscriptions` ãŒ500ã‚¨ãƒ©ãƒ¼
- "Internal Server Error" ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› : ãƒ¡ã‚½ãƒƒãƒ‰åã®ä¸ä¸€è‡´**

`getSubscribedChannels()` ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ `getSubscribedUserIds()`ã€‚

**è§£æ±ºæ¸ˆã¿ï¼ˆ`server/src/routes/eventsub.ts:39`ï¼‰:**
```typescript
// âŒ ä¿®æ­£å‰
const channelIds = twitchEventSubManager.getSubscribedChannels();

// âœ… ä¿®æ­£å¾Œ
const channelIds = twitchEventSubManager.getSubscribedUserIds();
```

### 16.10.3 EventSubå†æ¥ç¶šå¤±æ•—

**ç—‡çŠ¶:**
- ã€Œå†æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€ã‚¨ãƒ©ãƒ¼
- EventSubã®æ¥ç¶šãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã‚‰ãªã„

**åŸå› 1: reconnectAll() ãƒ¡ã‚½ãƒƒãƒ‰ãŒå­˜åœ¨ã—ãªã„**

**è§£æ±ºæ¸ˆã¿:** `reconnectAll()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ï¼ˆ`twitchEventSubManager.ts:219-246`ï¼‰

**åŸå› 2: èªè¨¼æƒ…å ±ãŒæœªè¨­å®š**

App Access Token ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã€èªè¨¼æƒ…å ±ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ã€‚

**è§£æ±ºç­–:**
1. EventSubç®¡ç†ç”»é¢ã§ã€ŒTwitchãƒ­ã‚°ã‚¤ãƒ³ã€ã‚’å®Ÿè¡Œ
2. User Access Token ã‚’å–å¾—
3. è‡ªå‹•çš„ã« `setCredentials()` ã¨ `reconnectAll()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹

**åŸå› 3: App Access Token ã®ä½¿ç”¨**

WebSocket EventSubã¯User Access TokenãŒå¿…é ˆã€‚

**ç¢ºèªæ–¹æ³•:**
```bash
# serverãƒ­ã‚°ã‚’ç¢ºèª
[EventSub] Failed to create subscription: 400 - {"error":"Bad Request","status":400,"message":"invalid transport and auth combination"}
```

**è§£æ±ºç­–:**
ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰Twitchãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œã—ã¦User Access Tokenã‚’å–å¾—ã€‚

### 16.10.4 Redirect Mismatch

**ç—‡çŠ¶:**
- `{"error":"redirect_mismatch"}`
- Twitch OAuthæ™‚ã«ã‚¨ãƒ©ãƒ¼

**åŸå› :** ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIãŒTwitch Developer Consoleã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–:**
1. https://dev.twitch.tv/console ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã‚’é–‹ã
3. OAuth Redirect URLs ã«ä»¥ä¸‹ã‚’è¿½åŠ :
   - `http://localhost:4000/auth/twitch/callback`
4. ä¿å­˜

### 16.10.5 æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹

**ç—‡çŠ¶:**
- ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰Twitchãƒ­ã‚°ã‚¤ãƒ³ã‚’å®Ÿè¡Œ
- æœ¬ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆport 4000ï¼‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹

**åŸå› :** Twitchã¯è¤‡æ•°ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å ´åˆã€æœ€åˆã®URIã‚’å„ªå…ˆä½¿ç”¨

**è§£æ±ºç­–ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰:**
Proxy Pattern ã‚’æ¡ç”¨ï¼š
1. ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã® `/auth/twitch?admin=true` ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
2. æœ¬ã‚µãƒ¼ãƒ“ã‚¹ãŒèªè¨¼ã‚’å‡¦ç†
3. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’EventSubManagerã«é€ä¿¡
4. ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### 16.10.6 CORS ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:**
```
Access to fetch at 'http://localhost:4001/api/admin/...' from origin 'http://localhost:5174' has been blocked by CORS policy
```

**åŸå› :** CORSã®è¨­å®šä¸è¶³

**è§£æ±ºç­–ï¼ˆ`admin-server/src/middleware/cors.ts`ï¼‰:**
```typescript
export const corsMiddleware = cors({
  origin: 'http://localhost:5174',
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization']
});
```

### 16.10.7 401ã‚¨ãƒ©ãƒ¼ã§è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ãªã„

**ç—‡çŠ¶:**
- èªè¨¼ã‚¨ãƒ©ãƒ¼æ™‚ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã•ã‚Œãšã€å¤ã„èªè¨¼æƒ…å ±ãŒæ®‹ã‚‹

**åŸå› :** auth-error ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒªã‚¹ãƒŠãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰:**
```typescript
// admin-web/src/App.tsx
useEffect(() => {
  const handleAuthError = () => {
    setIsAuthenticated(false);
    localStorage.removeItem('admin_username');
    localStorage.removeItem('admin_password');
  };

  window.addEventListener('auth-error', handleAuthError);
  return () => window.removeEventListener('auth-error', handleAuthError);
}, []);

// admin-web/src/services/apiClient.ts
if (response.status === 401) {
  window.dispatchEvent(new Event('auth-error'));
  throw new Error('Authentication failed');
}
```

---

## 16.11 ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 16.11.1 æœ¬ç•ªç’°å¢ƒã®è€ƒæ…®äº‹é …

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:** æœ¬ç•ªç’°å¢ƒã§ã¯æœ€ä½32æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
- **HTTPSå¿…é ˆ:** æœ¬ç•ªç’°å¢ƒã§ã¯HTTPSæ¥ç¶šã®ã¿ã‚’è¨±å¯
- **ç’°å¢ƒå¤‰æ•°ã®ä¿è­·:** `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’gitignoreã«è¿½åŠ 
- **IPåˆ¶é™:** ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ç‰¹å®šIPã«åˆ¶é™
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ:** ä¸€å®šæ™‚é–“æ“ä½œãŒãªã„å ´åˆã¯è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
- **ç›£æŸ»ãƒ­ã‚°:** ç®¡ç†æ“ä½œã®ãƒ­ã‚°ã‚’è¨˜éŒ²

#### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **ãƒ“ãƒ«ãƒ‰æœ€é©åŒ–:** `npm run build` ã§æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã‚’ä½œæˆ
- **é™çš„ãƒ•ã‚¡ã‚¤ãƒ«é…ä¿¡:** admin-webã¯CDNã¾ãŸã¯Nginxã§é…ä¿¡
- **APIã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°:** é »ç¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **WebSocketæ¥ç¶š:** EventSubç”¨WebSocketã®å®‰å®šæ€§ã‚’ç›£è¦–

#### å¯ç”¨æ€§
- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯:** `/health` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’è¿½åŠ 
- **è‡ªå‹•å†èµ·å‹•:** PM2ã‚„Systemdã§ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†
- **ã‚¨ãƒ©ãƒ¼é€šçŸ¥:** Slackã‚„ãƒ¡ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼é€šçŸ¥
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—:** Redisãƒ‡ãƒ¼ã‚¿ã®å®šæœŸãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

### 16.11.2 DockeråŒ–ï¼ˆæ¨å¥¨ï¼‰

**admin-server/Dockerfile:**
```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE 4001

CMD ["node", "dist/index.js"]
```

**admin-web/Dockerfile:**
```dockerfile
FROM node:18-alpine AS builder

WORKDIR /app

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

**docker-compose.yml:**
```yaml
version: '3.8'

services:
  admin-server:
    build: ./admin-server
    ports:
      - "4001:4001"
    environment:
      - PORT=4001
      - ADMIN_USERNAME=${ADMIN_USERNAME}
      - ADMIN_PASSWORD=${ADMIN_PASSWORD}
      - MAIN_BACKEND_URL=http://server:4000
      - REDIS_URL=redis://redis:6379
    depends_on:
      - redis

  admin-web:
    build: ./admin-web
    ports:
      - "5174:80"

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
```

### 16.11.3 ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

**æœ¬ç•ªç’°å¢ƒã§ã®æ¨å¥¨æ–¹æ³•:**
- AWS Secrets Manager
- Google Cloud Secret Manager
- HashiCorp Vault
- Kubernetes Secrets

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
```bash
# .env.production.example ã‚’ç”¨æ„
ADMIN_USERNAME=admin
ADMIN_PASSWORD=<CHANGE_THIS_TO_STRONG_PASSWORD>
SESSION_SECRET=<GENERATE_RANDOM_32_CHARS>
REDIS_URL=redis://redis:6379
MAIN_BACKEND_URL=http://server:4000
```

### 16.11.4 ç›£è¦–ã¨ãƒ­ã‚°

**æ¨å¥¨ãƒ„ãƒ¼ãƒ«:**
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç›£è¦–:** New Relic, Datadog
- **ãƒ­ã‚°é›†ç´„:** ELK Stack, CloudWatch Logs
- **ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°:** Sentry
- **ã‚¢ãƒƒãƒ—ã‚¿ã‚¤ãƒ ç›£è¦–:** UptimeRobot, Pingdom

**å®Ÿè£…ä¾‹ï¼ˆWinston Loggerï¼‰:**
```typescript
import winston from 'winston';

export const logger = winston.createLogger({
  level: process.env.NODE_ENV === 'production' ? 'info' : 'debug',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' }),
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ]
});
```

---

## 16.12 å°†æ¥ã®æ‹¡å¼µè¨ˆç”»

### 16.12.1 Phase 6: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†æ©Ÿèƒ½

- **ã‚µãƒ¼ãƒãƒ¼æƒ…å ±**
  - CPUä½¿ç”¨ç‡
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
  - ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡
  - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµ±è¨ˆ
- **ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†**
  - ã‚µãƒ¼ãƒãƒ¼ã®å†èµ·å‹•
  - ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
- **ç’°å¢ƒå¤‰æ•°**
  - ç’°å¢ƒå¤‰æ•°ã®è¡¨ç¤ºï¼ˆæ©Ÿå¯†æƒ…å ±ã¯éè¡¨ç¤ºï¼‰
  - è¨­å®šã®å‹•çš„å¤‰æ›´

### 16.12.2 Phase 7: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- **ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´**
  - æˆåŠŸ/å¤±æ•—ã®è¨˜éŒ²
  - IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®è¿½è·¡
  - ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±
- **ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹æ¤œå‡º**
  - é€£ç¶šå¤±æ•—ã®æ¤œå‡º
  - ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º
- **IPãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°**
  - ç‰¹å®šIPã®æ‰‹å‹•ãƒ–ãƒ­ãƒƒã‚¯
  - è‡ªå‹•ãƒ–ãƒ­ãƒƒã‚¯ãƒ«ãƒ¼ãƒ«

### 16.12.3 Phase 8: é…ä¿¡ç®¡ç†æ©Ÿèƒ½

- **é…ä¿¡ä¸€è¦§**
  - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–é…ä¿¡ã®è¡¨ç¤º
  - é…ä¿¡çµ±è¨ˆï¼ˆè¦–è´è€…æ•°ã€ãƒãƒ£ãƒƒãƒˆæ•°ï¼‰
- **é…ä¿¡è€…ç®¡ç†**
  - é…ä¿¡è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚°
  - é…ä¿¡å±¥æ­´
- **é…ä¿¡åˆ†æ**
  - æ™‚é–“å¸¯åˆ¥çµ±è¨ˆ
  - ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥çµ±è¨ˆ

### 16.12.4 Phase 9: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§**
  - ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡¨ç¤º
  - èªè¨¼çŠ¶æ…‹ã®ç¢ºèª
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°**
  - è¦–è´å±¥æ­´
  - ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ãƒ­ã‚°
- **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†**
  - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æœ‰åŠ¹åŒ–/ç„¡åŠ¹åŒ–
  - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ

### 16.12.5 Phase 10: ãƒ­ã‚°ç®¡ç†æ©Ÿèƒ½

- **ãƒ­ã‚°ãƒ“ãƒ¥ãƒ¼ã‚¢**
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ­ã‚°ã‚¹ãƒˆãƒªãƒ¼ãƒ 
  - ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  - å…¨æ–‡æ¤œç´¢
- **ã‚¨ãƒ©ãƒ¼è¿½è·¡**
  - ã‚¨ãƒ©ãƒ¼ä¸€è¦§
  - ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹è¡¨ç¤º
  - ã‚¨ãƒ©ãƒ¼çµ±è¨ˆ
- **ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°**
  - APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã”ã¨ã®çµ±è¨ˆ
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ åˆ†æ

### 16.12.6 Phase 11: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†æ©Ÿèƒ½

- **Redisç®¡ç†**
  - ã‚­ãƒ¼ã®æ¤œç´¢
  - ã‚­ãƒ¼ã®å‰Šé™¤
  - TTLã®ç¢ºèª
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆ**
  - ãƒ’ãƒƒãƒˆç‡
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
  - ã‚­ãƒ¼ã®æ•°
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢**
  - å…¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
  - ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã§ã‚¯ãƒªã‚¢

### 16.12.7 Phase 12: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰

- **ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ**
  - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®ON/OFF
  - ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é€šçŸ¥ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- **ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«**
  - å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š
  - è‡ªå‹•ON/OFF
- **é€šçŸ¥**
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®äº‹å‰é€šçŸ¥
  - å®Œäº†é€šçŸ¥

---

## 16.13 ä»˜éŒ²

### 16.13.1 ç”¨èªé›†

- **EventSub**: Twitch ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆWebSocketç‰ˆï¼‰
- **Basic Auth**: HTTPã®åŸºæœ¬èªè¨¼æ–¹å¼ï¼ˆBase64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼‰
- **Proxy Pattern**: ä¸­é–“ã‚µãƒ¼ãƒãƒ¼ã‚’ä»‹ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è»¢é€ã™ã‚‹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³
- **User Access Token**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã«ã‚ˆã‚Šå–å¾—ã•ã‚Œã‚‹ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
- **App Access Token**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èªè¨¼ã«ã‚ˆã‚Šå–å¾—ã•ã‚Œã‚‹ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
- **Redirect URI**: OAuthèªè¨¼å¾Œã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹URL
- **CORS**: Cross-Origin Resource Sharingï¼ˆã‚ªãƒªã‚¸ãƒ³é–“ãƒªã‚½ãƒ¼ã‚¹å…±æœ‰ï¼‰
- **localStorage**: ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆæ°¸ç¶šãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼‰
- **WebSocket**: åŒæ–¹å‘é€šä¿¡ãƒ—ãƒ­ãƒˆã‚³ãƒ«

### 16.13.2 å‚è€ƒãƒªãƒ³ã‚¯

- **Twitch EventSub Documentation**: https://dev.twitch.tv/docs/eventsub/
- **Twitch OAuth Documentation**: https://dev.twitch.tv/docs/authentication/
- **Express.js Documentation**: https://expressjs.com/
- **React Documentation**: https://react.dev/
- **TypeScript Documentation**: https://www.typescriptlang.org/docs/

### 16.13.3 å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|---------|
| 2025-10-27 | 1.0.0 | åˆç‰ˆä½œæˆ - Phase 5å®Œäº†æ™‚ç‚¹ã®ä»•æ§˜æ›¸ |
| 2025-11-04 | 1.1.0 | ç›£æŸ»ãƒ­ã‚°ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆæ©Ÿèƒ½è¿½åŠ <br>- ç›£æŸ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAuditLogsï¼‰ã®å®Ÿè£…<br>- ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆAlertsï¼‰ã®å®Ÿè£…<br>- ã‚µãƒ¼ãƒãƒ¼ç›£è¦–ï¼ˆServerMonitorï¼‰ã®è¿½åŠ <br>- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³APIè¿½åŠ <br>- ç®¡ç†ã‚¿ãƒ–æ•°: 12 â†’ 15 |

---

## 16.14 ã¾ã¨ã‚

**ãµãã¾ã©ï¼ç®¡ç†ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**ã¯ã€æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã®é‹ç”¨ã‚’åŠ¹ç‡åŒ–ã™ã‚‹ãŸã‚ã®é‡è¦ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

### ä¸»è¦ãªè¨­è¨ˆæ€æƒ³

1. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: 3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨Basicèªè¨¼ã«ã‚ˆã‚‹å¤šé‡é˜²å¾¡
2. **ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆ**: å¿…è¦æœ€å°é™ã®æ©Ÿèƒ½ã‹ã‚‰å§‹ã‚ã€æ®µéšçš„ã«æ‹¡å¼µ
3. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–**: EventSubã®çŠ¶æ…‹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŠŠæ¡
4. **ä¿å®ˆæ€§**: TypeScriptã¨ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼è¨­è¨ˆã«ã‚ˆã‚‹é•·æœŸä¿å®ˆæ€§

### ç¾åœ¨ã®å®Ÿè£…çŠ¶æ…‹ï¼ˆ2025-11-04æ™‚ç‚¹ï¼‰

- âœ… åŸºæœ¬ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ§‹ç¯‰ï¼ˆ3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰
- âœ… Basicèªè¨¼ã®å®Ÿè£…
- âœ… EventSubç®¡ç†æ©Ÿèƒ½
- âœ… Twitch OAuthçµ±åˆï¼ˆProxy Patternï¼‰
- âœ… è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
- âœ… çµ±è¨ˆæƒ…å ±ã®å¯è¦–åŒ–
- âœ… ç›£æŸ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆç®¡ç†è€…æ“ä½œã®è¨˜éŒ²ã¨è¿½è·¡ï¼‰
- âœ… ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆã®ç®¡ç†ï¼‰
- âœ… ã‚µãƒ¼ãƒãƒ¼ç›£è¦–æ©Ÿèƒ½ï¼ˆãƒªã‚½ãƒ¼ã‚¹è©³ç´°ç›£è¦–ï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
- âœ… 15ã‚¿ãƒ–ã®ç®¡ç†ç”»é¢ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã€PVçµ±è¨ˆã€ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã€ã‚·ã‚¹ãƒ†ãƒ ã€ã‚µãƒ¼ãƒãƒ¼ç›£è¦–ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã€é…ä¿¡ç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€ãƒ­ã‚°é–²è¦§ã€ç›£æŸ»ãƒ­ã‚°ã€ã‚¢ãƒ©ãƒ¼ãƒˆã€EventSubã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥/DBã€APIç›£è¦–ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ï¼‰

### å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã®è©³ç´°

#### ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **ç›£æŸ»ãƒ­ã‚°**: å…¨ç®¡ç†è€…æ“ä½œã®è¨˜éŒ²ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- **ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ **: CPU/ãƒ¡ãƒ¢ãƒªé«˜ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ä½ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆç­‰ã®ç®¡ç†
- **IPãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°**: ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã®è‡ªå‹•ãƒ»æ‰‹å‹•ãƒ–ãƒ­ãƒƒã‚¯

#### é‹ç”¨ç®¡ç†
- **ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰**: ãƒã‚¤ãƒ‘ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã€ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†**: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã€æ¥ç¶šçŠ¶æ…‹ç›£è¦–
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç®¡ç†**: Redisçµ±è¨ˆã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢

#### ç›£è¦–ãƒ»åˆ†æ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–**: WebSocketçµŒç”±ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹æ›´æ–°
- **PVçµ±è¨ˆ**: ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼åˆ†æã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- **ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œå‹•è¿½è·¡ã€ã‚¤ãƒ™ãƒ³ãƒˆåˆ†æ

### ä»Šå¾Œã®å±•é–‹

ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯ç¶™ç¶šçš„ã«æ©Ÿèƒ½å¼·åŒ–ãŒè¡Œã‚ã‚Œã¾ã™ã€‚å°†æ¥ã®æ‹¡å¼µå€™è£œï¼š
- ã‚ˆã‚Šé«˜åº¦ãªã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ï¼ˆãƒ¡ãƒ¼ãƒ«/Slack/Webhookçµ±åˆï¼‰
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ©Ÿèƒ½
- ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ
- å¤šè¨€èªå¯¾å¿œ

ã“ã®ä»•æ§˜æ›¸ã¯ã€é–‹ç™ºã®é€²æ—ã«å¿œã˜ã¦éšæ™‚æ›´æ–°ã•ã‚Œã¾ã™ã€‚
